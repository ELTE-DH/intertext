(this["webpackJsonpintertext-client"]=this["webpackJsonpintertext-client"]||[]).push([[0],{532:function(e,t,n){},533:function(e,t,n){},534:function(e,t,n){},535:function(e,t,n){},536:function(e,t,n){},537:function(e,t,n){},538:function(e,t,n){},539:function(e,t,n){},540:function(e,t,n){},541:function(e,t,n){},542:function(e,t,n){},543:function(e,t,n){},544:function(e,t,n){},545:function(e,t,n){},546:function(e,t,n){},547:function(e,t,n){},548:function(e,t,n){},549:function(e,t,n){},551:function(e,t,n){"use strict";n.r(t);n(254);var a=n(2),r=n.n(a),i=n(15),c=n.n(i),s=n(9),o=n(84),l=n(107),u=n(34),d=n(237),h=n(238),f={feature:"author",data:[],xDomain:[],width:0,columnCounts:{},active:null,matches:[],type:"",file_id:"",author:"",title:"",image:null,err:null},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_WAFFLE_VISIBILITY":return Object.assign({},e,{displayed:t.visible});case"SET_WAFFLE_FEATURE":return Object.assign({},e,{feature:t.feature});case"WAFFLE_IMAGE_REQUEST_FAILED":return Object.assign({},e,{err:!0});case"RECEIVE_WAFFLE_IMAGE":return Object.assign({},e,{image:t.url});case"SET_WAFFLE_VISUALIZED":return Object.assign({},e,{type:t.obj.type,title:t.obj[t.obj.type+"_title"],file_id:t.obj[t.obj.type+"_file_id"],author:t.obj[t.obj.type+"_author"],active:null});case"SET_WAFFLE_DATA":return Object.assign({},e,{data:t.obj.data,xDomain:t.obj.xDomain,feature:t.obj.feature,width:t.obj.width,columnCounts:t.obj.columnCounts,maxColumn:t.obj.maxColumn,levelMargin:t.obj.levelMargin,matches:t.obj.matches});case"SET_WAFFLE_ACTIVE":return Object.assign({},e,{active:t.obj});default:return e}},b=n(52),p={title:"",author:"",fileId:"",changed:0},m={results:[],allResults:[],maxDisplayed:10,sortField:"length",sortIndex:null,config:{},advanced:{similarity:[1,100],displayedSimilarity:[1,100],length:[1,25],displayedLength:[1,25],changed:0,earlier:p,later:p},resultsMeta:{err:!1,loading:!0,totalResults:0}},g=function(e){var t=0;return["similarity","length"].forEach((function(n){e.advanced[n].toString()!==m.advanced[n].toString()&&t++})),t},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_SEARCH":return Object.assign({},e,m);case"SET_SORT_FIELD":return Object.assign({},e,{sortField:t.sortField});case"SET_SORT_ORDER_INDEX":return Object.assign({},e,{sortIndex:t.sortIndex});case"SET_ADVANCED_FILTER":var n=t.earlierLater,a=t.field,r="fileId"===t.field?t.value?parseInt(t.value):"":t.value,i=Object.assign({},e.advanced[n],Object(b.a)({},a,r)),c=0;return Object.keys(p).forEach((function(e){"changed"!==e&&p[e]!==i[e]&&c++})),i.changed=c,Object.assign({},e,{advanced:Object.assign({},e.advanced,Object(b.a)({},n,i))});case"SET_ADVANCED_FILTER_LENGTH":return Object.assign({},e,{advanced:Object.assign({},e.advanced,{length:t.val})});case"SET_ADVANCED_FILTER_DISPLAYED_LENGTH":return Object.assign({},e,{advanced:Object.assign({},e.advanced,{displayedLength:t.val})});case"SET_ADVANCED_FILTER_SIMILARITY":return Object.assign({},e,{advanced:Object.assign({},e.advanced,{similarity:t.val})});case"SET_ADVANCED_FILTER_DISPLAYED_SIMILARITY":return Object.assign({},e,{advanced:Object.assign({},e.advanced,{displayedSimilarity:t.val})});case"SET_ADVANCED_FILTER_CHANGE_COUNT":return Object.assign({},e,{advanced:Object.assign({},e.advanced,{changed:g(e)})});case"CLEAR_ADVANCED_FILTER_TYPE":return Object.assign({},e,{advanced:Object.assign({},e.advanced,Object(b.a)({},t.earlierLater,p))});case"CLEAR_ADVANCED_FILTERS":return Object.assign({},e,{advanced:Object.assign({},m.advanced)});case"LOAD_SEARCH_FROM_URL":var s=Object.assign({},e,{advanced:Object.assign({},e.advanced,{earlier:t.obj.earlier?t.obj.earlier:e.advanced.earlier,later:t.obj.later?t.obj.later:e.advanced.later})});return Object.assign({},e,s);case"DISPLAY_MORE_SEARCH_RESULTS":var o=e.maxDisplayed+10;return Object.assign({},e,{maxDisplayed:o,results:e.allResults.slice(0,o)});case"RESET_MAX_DISPLAYED_SEARCH_RESULTS":return Object.assign({},e,{maxDisplayed:10});case"SET_SEARCH_LOADING":return Object.assign({},e,{resultsMeta:Object.assign({},e.resultsMeta,{loading:t.bool})});case"SET_ALL_SEARCH_RESULTS":return Object.assign({},e,{results:t.docs,allResults:t.docs,resultsMeta:Object.assign({},e.resultsMeta,{totalResults:t.total,err:t.err,loading:!1})});case"SET_SEARCH_RESULTS":return Object.assign({},e,{results:t.results});case"SET_CONFIG":return Object.assign({},e,{config:Object.assign({},{infiles:t.config.infiles,window_size:t.config.window_size,window_slide:t.config.window_slide})});default:return e}},y=n(132),O={source:[],target:[]},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_FAVORITE":return Object.assign({},e,Object(b.a)({},t.obj.type,[].concat(Object(y.a)(e[t.obj.type]),[t.obj._id])));case"REMOVE_FAVORITE":return Object.assign({},e,Object(b.a)({},t.obj.type,e[t.obj.type].filter((function(e){return e!==t.obj._id}))));case"LOAD_FAVORITES":return Object.assign({},e,t.obj);default:return e}},E={query:"",index:0,err:null,field:"title",fileIds:null,metadata:null},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TYPEAHEAD_FIELD":return Object.assign({},e,{field:t.field.toLowerCase()});case"SET_TYPEAHEAD_QUERY":return Object.assign({},e,{query:t.query});case"SET_TYPEAHEAD_INDEX":return Object.assign({},e,{index:t.index});case"RECEIVE_TYPEAHEAD_FILE_IDS":return Object.assign({},e,{fileIds:t.fileIds,metadata:t.metadata,err:null});case"TYPEAHEAD_REQUEST_FAILED":return Object.assign({},e,{err:!0});default:return e}},A={unit:"passage",data:[],use:"earlier",statistic:"mean",xDomain:[],yDomain:[],y:"target_year",zoomed:!1,jitter:!1,tooltip:{title:"",author:"",x:"",y:""},err:!1},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_UNIT":return Object.assign({},e,{unit:t.unit});case"SET_USE":return Object.assign({},e,{use:t.use,y:"earlier"===t.use?"target_year":"source_year"});case"SET_STATISTIC":return Object.assign({},e,{statistic:t.stat});case"SET_Y":return Object.assign({},e,{y:t.y});case"SET_TOOLTIP":return Object.assign({},e,{tooltip:t.obj});case"TOGGLE_JITTER":return Object.assign({},e,{jitter:!e.jitter});case"SET_DOMAINS":return Object.assign({},e,{xDomain:t.domains.x,yDomains:t.domains.y,zoomed:!0});case"REMOVE_ZOOM":return Object.assign({},e,{xDomain:[],yDomain:[],zoomed:!1});case"SCATTERPLOT_REQUEST_FAILED":return Object.assign({},e,{err:!0});case"RECEIVE_SCATTERPLOT_RESULTS":return Object.assign({},e,{data:t.obj.data,xDomain:t.obj.xDomain,yDomain:t.obj.yDomain,zoomed:t.obj.zoomed,statistic:t.obj.statistic||e.statistic});default:return e}},T={fileId:null,matches:null,words:null},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VIEWER_DATA":return Object.assign({},e,{fileId:t.fileId,matches:t.matches,words:t.words});default:return e}},I={},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_RECORD_TO_CACHE":var n={};return n[t.key]=t.value,Object.assign({},e,n);default:return e}},L=Object(o.c)({search:v,favorites:x,typeahead:w,scatterplot:S,waffle:j,viewer:_,cache:R}),D=function(e){return{type:"ADD_FAVORITE",obj:e}},k=function(e){return{type:"REMOVE_FAVORITE",obj:e}},C=function(){return function(e,t){try{localStorage.setItem("favorites",JSON.stringify(t().favorites))}catch(n){console.warn(n)}}},N=n(28),F=n(18),M=n(239),H=n.n(M),V=function(e){var t=window.location.href.split("#")[0].replace("index.html","");return e="/"===e[0]?e.substring(1):e,H()(t+e).then((function(t){if(200!==t.status)throw new Error("Fetch failed (Status = "+t.status+"): "+e);return t.json()})).then((function(e){return e}))},U=function(e,t){return{type:"ADD_RECORD_TO_CACHE",key:e,value:t}},W=n(70),P=function(e){return{type:"SET_TYPEAHEAD_FIELD",field:e}},Y=function(e){return{type:"SET_TYPEAHEAD_QUERY",query:e}},B=function(e){return{type:"SET_TYPEAHEAD_INDEX",index:e}},z=function(){return function(e,t){var n=t(),a="/api/indices/match-ids-by-".concat(n.search.sortField.toLowerCase().trim(),".json");return V(a).then((function(t){e({type:"SET_SORT_ORDER_INDEX",sortIndex:t})})).catch((function(e){console.warn("Could not fetch sort order: "+e)}))}},J=function(e){return Object(F.a)({type:"SET_ADVANCED_FILTER"},e)},Z=function(e){return function(t){t({type:"CLEAR_ADVANCED_FILTER_TYPE",earlierLater:e})}},q=function(){return function(e,t){var n=t();e(re(!0));var a=function(){e(X()),e(B(0)),e(Q()),e(G())};n.search.sortIndex&&n.typeahead.metadata?a():Promise.all([e(z()),e((function(e){return V("/api/config.json").then((function(t){var n;e({type:"SET_CONFIG",config:t}),e((n=t.metadata,function(e){var t={author:{},title:{}};n.forEach((function(e,n){t.author[e.author]=e.author in t.author?t.author[e.author].concat(n):[n],t.title[e.title]=e.title in t.title?t.title[e.title].concat(n):[n]})),e({type:"RECEIVE_TYPEAHEAD_FILE_IDS",fileIds:t,metadata:n})}))})).catch((function(e){console.warn("Could not fetch config: "+e)}))}))]).then((function(e){a()}))}},G=function(){return function(e,t){var n=t(),a=K(n),r=a.slice(0,n.search.maxDisplayed),i=Object(W.uniq)(r.map((function(e){return e[1]})));e(ee(i)).then((function(e){var t=r.reduce((function(t,n){var a=Object(N.a)(n,2),r=a[0],c=a[1];return t.push(e[i.indexOf(c)][r]),t}),[]);return{count:a.length,docs:t}})).then((function(t){var n=t.count,a=t.docs;e({type:"SET_ALL_SEARCH_RESULTS",docs:a,total:n,err:!1})})).catch((function(t){e({type:"SET_ALL_SEARCH_RESULTS",docs:[],err:t})}))}},X=function(){return{type:"RESET_MAX_DISPLAYED_SEARCH_RESULTS"}},Q=function(){return function(){var e=document.querySelector("#result-pairs-container");e&&e.scrollTo(0,0)}},K=function(e){var t=Object(F.a)({},e.search),n=t.sortIndex,a=t.advanced,r=Object(F.a)({},e.typeahead),i=r.fileIds,c=r.field,s=r.query;if(i){var o=function(e,t){var n=new Set;return Object.keys(t).map((function(a){return e&&e.length?a.trim().toLowerCase().includes(e.trim().toLowerCase())&&t[a].map((function(e){return n.add(e)})):t[a].map((function(e){return n.add(e)})),null})),n},l=function(e,t){return Number.isInteger(a[e].fileId)?new Set([a[e].fileId]):u([o(a[e].title,t.title),o(a[e].author,t.author)])},u=function(e){return new Set(e.reduce((function(e,t){return Object(y.a)(e).filter((function(e){return t.has(e)}))})))},d={either:o(s,i[c]),earlier:l("earlier",i),later:l("later",i)};return n.filter((function(e){var t=$(e);return!(t.similarity<a.similarity[0]||t.similarity>a.similarity[1])&&(!(t.length<a.length[0]||t.length>a.length[1])&&(!!d.earlier.has(t.earlierId)&&(!!d.later.has(t.laterId)&&!(!d.either.has(t.earlierId)&&!d.either.has(t.laterId)))))}))}},$=function(e){return{id:e[0],earlierId:e[1],laterId:e[2],length:e[3],probability:e[4],similarity:e[5]}},ee=function(e){return function(t,n){return Promise.all(e.map((function(e){return t(te(e))})))}},te=function(e){return function(t,n){var a=n(),r="matches/".concat(e,".json");return r in a.cache?new Promise((function(e,t){return e(a.cache[r])})):ae(e).then((function(e){return t(U(r,e)),e}))}},ne=function(e){return V("/api/texts/"+e.toString()+".json")},ae=function(e){return V("/api/matches/"+e.toString()+".json")},re=function(e){return{type:"SET_SEARCH_LOADING",bool:e}},ie=(n(475),Object(u.b)()),ce=(Object(d.createLogger)(),[h.a,Object(l.routerMiddleware)(ie)]);var se=o.a.apply(void 0,ce),oe=Object(o.d)(Object(l.connectRouter)(ie)(L),se);oe.dispatch((function(e,t){var n=localStorage.getItem("favorites");n&&e({type:"LOAD_FAVORITES",obj:JSON.parse(n)})})),oe.dispatch(q());var le=n(25),ue=n(20),de=n(21),he=n(22),fe=n(23),je=n(58),be=n(1),pe=[{route:"/cards",label:"Cards"},{route:"/sankey",label:"Sankey"},{route:"/works",label:"Works"}],me=Object(s.connect)((function(e){return{route:e.router.location.pathname}}))((function(e){return Object(be.jsx)("header",{children:Object(be.jsxs)("div",{className:"header-text row align-center space-between",children:[Object(be.jsx)(je.a,{className:"brand",to:"/",children:Object(be.jsx)("img",{src:"data:image/png;base64,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",alt:"Intertext brand logo"})}),Object(be.jsx)("nav",{className:"row align-center",children:pe.map((function(t){return Object(be.jsx)(je.a,{to:t.route,className:e.route===t.route?"active":"",children:t.label},t.route)}))}),Object(be.jsx)("div",{style:{width:"132px"}})]})})})),ge=n.p+"static/media/yale-mark.59f2ddfb.svg",ve=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsxs)("footer",{className:"row space-between align-center",children:[Object(be.jsx)("a",{className:"row align-center",href:"https://dhlab.yale.edu",children:Object(be.jsx)("img",{className:"yale-mark",src:ge,alt:"Yale University Watermark"})}),Object(be.jsx)("div",{className:"experiment",children:"An experiment of the Yale DHLab"})]})}}]),n}(r.a.Component),ye=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsxs)("div",{className:"app-container col",children:[Object(be.jsx)(me,{}),Object(be.jsx)("div",{className:"page-container flex-1",children:this.props.children}),Object(be.jsx)(ve,{})]})}}]),n}(r.a.Component),Oe=n(26),xe=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(e){var a;return Object(ue.a)(this,n),(a=t.call(this,e)).handleChange=a.handleChange.bind(Object(Oe.a)(a)),a}return Object(de.a)(n,[{key:"handleChange",value:function(e){this.props.setSortAndSearch(e.target.value)}},{key:"render",value:function(){return Object(be.jsxs)("select",{className:"sort-results",value:this.props.sortField,onChange:this.handleChange,children:[Object(be.jsx)("option",{disabled:!0,children:"Sort By"}),Object(be.jsx)("option",{value:"length",children:"Length"}),Object(be.jsx)("option",{value:"similarity",children:"Similarity"}),Object(be.jsx)("option",{value:"probability",children:"Probability"}),Object(be.jsx)("option",{value:"author",children:"Author"}),Object(be.jsx)("option",{value:"title",children:"Title"}),Object(be.jsx)("option",{value:"year",children:"Date"})]})}}]),n}(r.a.Component),Ee=Object(s.connect)((function(e){return{sortField:e.search.sortField}}),(function(e){return{setSortAndSearch:function(t){return e(function(e){return function(t){t({type:"SET_SORT_FIELD",sortField:e}),t(z()).then((function(){t(q())}))}}(t))}}}))(xe),we=Object(s.connect)((function(e){return{loading:e.search.loading,totalResults:e.search.resultsMeta.totalResults}}))((function(e){return Object(be.jsx)("div",{className:"results-count",children:e.loading?null:Object(be.jsxs)(be.Fragment,{children:[Object(be.jsx)("span",{children:e.totalResults||0}),Object(be.jsx)("span",{children:"matches"})]})})})),Ae=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(e){var a;return Object(ue.a)(this,n),(a=t.call(this,e)).handleMousedown=a.handleMousedown.bind(Object(Oe.a)(a)),a.handleMouseup=a.handleMouseup.bind(Object(Oe.a)(a)),a}return Object(de.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("mousedown",this.handleMousedown,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousedown",this.handleMousedown,!1)}},{key:"handleMousedown",value:function(e){"typeahead-result"===e.target.className&&(e.stopPropagation(),e.preventDefault())}},{key:"handleMouseup",value:function(e){e.target.className.includes("typeahead-result")&&(this.props.setTypeaheadQuery(e.target.getAttribute("data-value")),this.props.fetchSearchResults(),document.querySelector(".typeahead input").blur())}},{key:"render",value:function(){var e=this,t=this.props.results.length>0?"":"hidden";return Object(be.jsxs)("span",{className:"typeahead-results "+t,children:[this.props.query.length>0?Object(be.jsx)("span",{className:0===this.props.index?"typeahead-result search-icon active":"typeahead-result search-icon",children:this.props.query}):Object(be.jsx)("span",{}),this.props.results.map((function(t,n){return Object(be.jsx)(Se,{val:t,onClick:e.handleMouseup,active:n+1===e.props.index,submitSearch:e.props.submitSearch},n)}))]})}}]),n}(r.a.Component),Se=function(e){return Object(be.jsx)("span",{onClick:e.onClick,className:e.active?"typeahead-result active":"typeahead-result","data-value":e.val,children:e.val})},Te=Object(s.connect)((function(e){return{results:e.typeahead.fileIds?Object.keys(e.typeahead.fileIds[e.typeahead.field]):[],query:e.typeahead.query,index:e.typeahead.index}}),(function(e){return{setTypeaheadQuery:function(t){return e(Y(t))},fetchSearchResults:function(){return e(q())}}}))(Ae),_e=Object(s.connect)((function(e){return{index:e.typeahead.index,results:e.typeahead.results,query:e.typeahead.query}}),(function(e){return{setTypeaheadQuery:function(t){return e(Y(t))},setTypeaheadIndex:function(t){return e(B(t))},fetchSearchResults:function(){return e(q())}}}))((function(e){var t=Object(a.useRef)(),n=function(){var n=0===e.index?e.query:e.results[e.index-1];e.setTypeaheadQuery(n),e.fetchSearchResults(),t.current.blur()};return Object(be.jsxs)("div",{className:"typeahead",children:[Object(be.jsx)("div",{className:"search-button"}),Object(be.jsx)("input",{ref:t,value:e.query,onKeyUp:function(t){var a=e.index;38===t.keyCode?a-1>=0&&e.setTypeaheadIndex(a-1):40===t.keyCode?a+1<=e.results.length&&e.setTypeaheadIndex(a+1):13===t.keyCode&&n()},onChange:function(t){38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode&&(e.setTypeaheadQuery(t.target.value),e.setTypeaheadIndex(0))}}),Object(be.jsx)(Te,{submitSearch:n})]})})),Ie=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsx)("div",{className:"typeahead-select-container",children:Object(be.jsxs)("select",{className:"custom-select",onChange:this.props.setTypeaheadField,value:this.props.field,children:[Object(be.jsx)("option",{disabled:!0,children:"Search By"}),Object(be.jsx)("option",{value:"author",children:"Author"}),Object(be.jsx)("option",{value:"title",children:"Title"})]})})}}]),n}(r.a.Component),Re=Object(s.connect)((function(e){return{field:e.typeahead.field}}),(function(e){return{setTypeaheadField:function(t){return e(P(t.target.value))}}}))(Ie),Le=n.p+"static/media/filter-icon.a96b9720.svg",De=n(184),ke=De.a.createSliderWithTooltip(De.a.Range),Ce=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(e){var a;return Object(ue.a)(this,n),(a=t.call(this,e)).setLength=a.setLength.bind(Object(Oe.a)(a)),a.setDisplayedLength=a.setDisplayedLength.bind(Object(Oe.a)(a)),a.setSimilarity=a.setSimilarity.bind(Object(Oe.a)(a)),a.setDisplayedSimilarity=a.setDisplayedSimilarity.bind(Object(Oe.a)(a)),a.clearAdvanced=a.clearAdvanced.bind(Object(Oe.a)(a)),a}return Object(de.a)(n,[{key:"setDisplayedLength",value:function(e){this.props.setDisplayedLength(e)}},{key:"setLength",value:function(e){this.props.setLength(e),this.props.search()}},{key:"setDisplayedSimilarity",value:function(e){this.props.setDisplayedSimilarity(e)}},{key:"setSimilarity",value:function(e){this.props.setSimilarity(e),this.props.search()}},{key:"clearAdvanced",value:function(){Me(document.querySelector("#advanced-filter-columns")),this.props.clearAdvanced()}},{key:"render",value:function(){var e=this,t=Object(F.a)({},this.props),n=t.open,a=t.selectionCount,r=t.refProp,i=t.displayedLength,c=t.displayedSimilarity,s="col space-between ";return n&&(s+="open "),a>0&&(s+="changed "),Object(be.jsxs)("div",{id:"advanced-filters",className:s,ref:r,children:[Object(be.jsx)("div",{id:"clear-advanced-filter",onClick:this.clearAdvanced,children:"Clear \u2a09"}),Object(be.jsxs)("div",{id:"shared-advanced-filters",children:[Object(be.jsxs)("div",{className:"shared-advanced-filter row align-center",children:[Object(be.jsx)("div",{className:"label",children:"Match Length"}),Object(be.jsx)(ke,{min:1,max:25,step:1,value:i,onChange:function(t){return e.setDisplayedLength(t)},onAfterChange:function(t){return e.setLength(t)}})]}),Object(be.jsxs)("div",{className:"shared-advanced-filter row align-center",children:[Object(be.jsx)("div",{className:"label",children:"Similarity"}),Object(be.jsx)(ke,{min:1,max:100,step:1,value:c,onChange:function(t){return e.setDisplayedSimilarity(t)},onAfterChange:function(t){return e.setSimilarity(t)}})]})]}),Object(be.jsxs)("div",{id:"advanced-filter-columns",className:"row",children:[Object(be.jsx)(Ne,Object(F.a)({earlierLater:"earlier"},this.props)),Object(be.jsx)(Ne,Object(F.a)({earlierLater:"later"},this.props))]})]})}}]),n}(r.a.Component),Ne=function(e){var t=Object(a.useRef)(),n=Object(a.useState)(!1),r=Object(N.a)(n,2),i=r[0],c=r[1],s=function(t,n,a){c(!0),e.setField({earlierLater:t,field:n,value:a})},o="advanced-filter-apply-button";o+=i?" active":" disabled";return Object(be.jsxs)("div",{className:"advanced-filter-column flex-1",ref:t,children:[Object(be.jsxs)("div",{className:"advanced-filter-column-label",children:[He(e.earlierLater)," Text"]}),[{label:"Author",field:"author",type:"text"},{label:"Title",field:"title",type:"text"},{label:"File Id",field:"fileId",type:"number"}].map((function(t){return Object(be.jsxs)("div",{className:"row justify-start align-center",children:[Object(be.jsx)("div",{className:"label",children:t.label}),"text"===t.type||"number"===t.type?Object(be.jsx)(Fe,{type:t.type,field:t.field,earlierLater:e.earlierLater,defaultValue:e.advanced[e.earlierLater][t.field],onChange:s}):null]},t.field)})),Object(be.jsxs)("div",{className:"advanced-filter-footer justify-end row align-center",children:[Object(be.jsx)("div",{className:e.advanced[e.earlierLater].changed>0?"advanced-filter-clear clearable":"advanced-filter-clear disabled",onClick:function(){Me(t.current),e.clearColumn(e.earlierLater)},children:"Clear"}),Object(be.jsx)("button",{className:o,onClick:function(){c(!1),e.search()},children:"Apply"})]})]})},Fe=function(e){return Object(be.jsx)("input",{defaultValue:e.defaultValue,onChange:function(t){return e.onChange(e.earlierLater,e.field,t.target.value)},type:e.type})},Me=function(e){e.querySelectorAll("input").forEach((function(e){return e.value=""}))},He=function(e){return e.substring(0,1).toUpperCase()+e.substring(1,e.length).toLowerCase()},Ve=Object(s.connect)((function(e){return{advanced:e.search.advanced,length:e.search.advanced.length,displayedLength:e.search.advanced.displayedLength,similarity:e.search.advanced.similarity,displayedSimilarity:e.search.advanced.displayedSimilarity}}),(function(e){return{setField:function(t){return e(J(t))},setLength:function(t){return e(function(e){return function(t){t({type:"SET_ADVANCED_FILTER_LENGTH",val:e}),t({type:"SET_ADVANCED_FILTER_CHANGE_COUNT"})}}(t))},setDisplayedLength:function(t){return e(function(e){return{type:"SET_ADVANCED_FILTER_DISPLAYED_LENGTH",val:e}}(t))},setSimilarity:function(t){return e(function(e){return function(t){t({type:"SET_ADVANCED_FILTER_SIMILARITY",val:e}),t({type:"SET_ADVANCED_FILTER_CHANGE_COUNT"})}}(t))},setDisplayedSimilarity:function(t){return e(function(e){return{type:"SET_ADVANCED_FILTER_DISPLAYED_SIMILARITY",val:e}}(t))},clearColumn:function(t){return e(Z(t))},search:function(){return e(q())},clearAdvanced:function(){return e((function(e){e({type:"CLEAR_ADVANCED_FILTERS"}),e(Y("")),e(q())}))}}}))(Ce),Ue=Object(s.connect)((function(e){return{selectionCount:(t=e.search.advanced,t.changed+t.earlier.changed+t.later.changed)};var t}),(function(e){return{}}))((function(e){var t=Object(a.useRef)(),n=Object(a.useRef)(),r=Object(a.useState)(!1),i=Object(N.a)(r,2),c=i[0],s=i[1];Object(a.useEffect)((function(){var e=function(e){var a=e.target;n.current&&!n.current.contains(a)&&t.current&&!t.current.contains(a)&&s(!1)};return window.addEventListener("mousedown",e),function(){window.removeEventListener("mousedown",e)}}),[c]);var o="";return c&&(o+="open "),e.selectionCount>0&&(o+="has-selection "),Object(be.jsxs)("div",{id:"filters-container",className:"col justify-center",ref:t,children:[Object(be.jsxs)("div",{id:"filters-inner",className:"row space-between justify-center align-center",children:[Object(be.jsxs)("div",{className:"filter-group row justify-start align-center",children:[Object(be.jsx)("span",{className:"typeahead-select-label",children:"Search all passages by"}),Object(be.jsx)(Re,{})]}),Object(be.jsx)(_e,{}),Object(be.jsxs)("div",{className:"filter-group row justify-end align-center",children:[Object(be.jsx)(we,{}),Object(be.jsx)(Ee,{}),Object(be.jsx)("img",{alt:"Advanced filters icon",className:o,id:"advanced-filters-icon",src:Le,onClick:function(){s(!c)}}),e.selectionCount>0?Object(be.jsx)("div",{id:"advanced-filters-selection-count",className:"row justify-center align-center",children:Object(be.jsx)("div",{children:e.selectionCount})}):null]})]}),Object(be.jsx)(Ve,{refProp:n,open:c,selectionCount:e.selectionCount})]})})),We=n(0),Pe=n.n(We),Ye=n(183),Be=n.n(Ye),ze=n(245),Je=function(){return function(e){ie.push("/waffle")}},Ze=function(e){return function(t,n){var a=n().waffle.matches.filter((function(t){return t._id===e._id}))[0];t({type:"SET_WAFFLE_ACTIVE",obj:Object.assign({},a)})}},qe=function(){return function(e,t){var n=t(),a=80,r=0;Ge(n.waffle.file_id,n.waffle.feature).then((function(t){var i=t.cols,c=Xe(i).reduce((function(e,t){return i[e]>i[t]?e:t})),s=Xe(i),o=s.length*(10*i[c]+10);o+=a+r,e({type:"SET_WAFFLE_DATA",obj:{matches:t.matches,data:t.cells,xDomain:s,feature:n.waffle.feature,width:o,columnCounts:i,maxColumn:i[c],levelMargin:10}})}))}},Ge=function(){var e=Object(ze.a)(Be.a.mark((function e(t,n){var a,r,i;return Be.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 10,a={},r={},i=[],e.abrupt("return",ae(t).then((function(e){return e.map((function(e,c){var s=e.source_file_id===t?e["target_"+n]:e["source_"+n];a[s]=a[s]>-1?a[s]+1:0;var o=Math.floor(a[s]/10),l=a[s]%10;return r[s]=r[s]?Math.max(r[s],o+1):1,i.push({row:l,column:o,xLevel:s.toString(),similarity:e.similarity,_id:e._id}),null})),{cells:i,cols:r,matches:e}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Xe=function(e){return Object.keys(e)},Qe=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsx)("svg",{className:"result-footer-icon read-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"-1378.033 1832 15.753 15.85",children:Object(be.jsx)("path",{d:"M15.587,13.5l-2.8-2.8a5.868,5.868,0,0,0,1.2-3.7A6.954,6.954,0,0,0,6.994,0,6.954,6.954,0,0,0,0,7a6.954,6.954,0,0,0,6.994,7,7.032,7.032,0,0,0,3.8-1.1l2.8,2.8a.483.483,0,0,0,.7,0l1.4-1.4A.755.755,0,0,0,15.587,13.5ZM6.994,12A4.949,4.949,0,0,1,2,7a4.949,4.949,0,0,1,5-5,4.949,4.949,0,0,1,5,5A4.949,4.949,0,0,1,6.994,12Z",transform:"translate(-1378.033 1832)"})})}}]),n}(r.a.Component),Ke=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsx)("svg",{className:"result-footer-icon favorite-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"-1093.271 1833 14.088 14",children:Object(be.jsx)("path",{d:"M10.991,0h-.6a3.721,3.721,0,0,0-3.3,1.763A3.976,3.976,0,0,0,3.8,0H3.2C1.8.207.2,1.452,0,4.044v.83C.2,7.259,1.9,10.267,7.094,14c5.1-3.733,6.894-6.741,6.994-9.126v-.83C13.888,1.452,12.29.207,10.991,0Z",transform:"translate(-1093.271 1833)"})})}}]),n}(r.a.Component),$e=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){return Object(be.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 17.5 17.5",children:[Object(be.jsx)("rect",{x:"0.8",y:"8.8",width:"8",height:"8"}),Object(be.jsx)("rect",{x:"8.8",y:"8.8",width:"8",height:"8"}),Object(be.jsx)("rect",{x:"8.8",y:"0.8",width:"8",height:"8"})]})}}]),n}(r.a.Component),et=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(e){var a;return Object(ue.a)(this,n),(a=t.call(this,e)).getText=a.getText.bind(Object(Oe.a)(a)),a.favorite=a.favorite.bind(Object(Oe.a)(a)),a.visualize=a.visualize.bind(Object(Oe.a)(a)),a.getFavoriteClass=a.getFavoriteClass.bind(Object(Oe.a)(a)),a}return Object(de.a)(n,[{key:"getText",value:function(e,t){return{__html:(t=t||"")+this.props.result[this.props.type+"_"+e]}}},{key:"favorite",value:function(){this.props.toggleFavorite({type:this.props.type,result:this.props.result})}},{key:"visualize",value:function(){this.props.visualize(Object.assign({},this.props.result,{type:this.props.type}))}},{key:"getFavoriteClass",value:function(){var e=this.props.result._id;return this.props.favorites[this.props.type].indexOf(e)>-1?"favorite active":"favorite"}},{key:"render",value:function(){var e=this.getText("author");return Object(be.jsxs)("div",{className:"result col space-between flex-1",children:[Object(be.jsx)("div",{className:"result-top row space-between align-center",children:"source"===this.props.type||this.props.headerRight?Object(be.jsx)(tt,{getText:this.getText}):Object(be.jsx)(nt,{getText:this.getText})}),Object(be.jsxs)("div",{className:"result-body flex-1",children:[e&&"Unknown"!=e.__html?Object(be.jsx)("div",{className:"result-author",dangerouslySetInnerHTML:e}):null,Object(be.jsxs)("div",{className:"result-match",children:[Object(be.jsx)("span",{className:"prematch",dangerouslySetInnerHTML:this.getText("prematch")}),Object(be.jsx)("span",{className:"match",dangerouslySetInnerHTML:this.getText("match"," ")}),Object(be.jsx)("span",{className:"postmatch",dangerouslySetInnerHTML:this.getText("postmatch"," ")})]})]}),Object(be.jsx)("div",{className:"result-footer-container",children:Object(be.jsxs)("div",{className:"result-footer row",children:[this.props.result[this.props.type+"_url"]?Object(be.jsx)(be.Fragment,{children:Object(be.jsxs)("a",{className:"read",target:"_blank",href:this.props.result[this.props.type+"_url"],rel:"noreferrer",children:[Object(be.jsx)(Qe,{}),"Read"]})}):null,Object(be.jsxs)("div",{onClick:this.favorite,className:this.getFavoriteClass(),children:[Object(be.jsx)(Ke,{}),"Favorite"]}),Object(be.jsxs)(je.a,{to:"waffle",onClick:this.visualize,className:"visualize",children:[Object(be.jsx)($e,{}),"Visualize"]})]})})]})}}]),n}(r.a.Component),tt=function(e){return Object(be.jsxs)(be.Fragment,{children:[Object(be.jsx)("div",{className:"result-title",dangerouslySetInnerHTML:e.getText("title")}),e.getText("year")?Object(be.jsx)("div",{className:"result-year-container header-left",children:Object(be.jsx)("div",{className:"result-year",dangerouslySetInnerHTML:e.getText("year")})}):null]})},nt=function(e){return Object(be.jsxs)(be.Fragment,{children:[Object(be.jsx)("div",{className:"result-year-container header-right",children:Object(be.jsx)("div",{className:"result-year",dangerouslySetInnerHTML:e.getText("year")})}),Object(be.jsx)("div",{className:"result-title",dangerouslySetInnerHTML:e.getText("title")})]})},at=(Pe.a.shape({_id:Pe.a.number,similarity:Pe.a.number.isRequired,source_author:Pe.a.string.isRequired,source_file_id:Pe.a.number.isRequired,source_filename:Pe.a.string.isRequired,source_match:Pe.a.string.isRequired,source_postmatch:Pe.a.string.isRequired,source_prematch:Pe.a.string.isRequired,source_segment_ids:Pe.a.arrayOf(Pe.a.number.isRequired),source_title:Pe.a.string.isRequired,source_url:Pe.a.string,source_year:Pe.a.string.isRequired,target_author:Pe.a.string.isRequired,target_file_id:Pe.a.number.isRequired,target_file_path:Pe.a.string.isRequired,target_filename:Pe.a.string.isRequired,target_match:Pe.a.string.isRequired,target_postmatch:Pe.a.string.isRequired,target_prematch:Pe.a.string.isRequired,target_segment_ids:Pe.a.arrayOf(Pe.a.number.isRequired),target_title:Pe.a.string.isRequired,target_url:Pe.a.string,target_year:Pe.a.string.isRequired}),Object(s.connect)((function(e){return{favorites:e.favorites,compare:e.compare}}),(function(e){return{toggleFavorite:function(t){return e(function(e){return function(t,n){var a=e.result._id;n().favorites[e.type].indexOf(a)>-1?t(k({type:e.type,_id:a})):t(D({type:e.type,_id:a})),t(C())}}(t))},visualize:function(t){return e(function(e){return function(t,n){t(function(e){return{type:"SET_WAFFLE_VISUALIZED",obj:e}}(e)),t(qe()),t(Je())}}(t))}}}))(et)),rt=function(e){return Object(be.jsx)("div",{className:"loader"})},it=function(e){return Object(be.jsx)("div",{children:e.results.map((function(e,t){return Object(be.jsxs)("div",{className:"result-pair row",children:[Object(be.jsx)(at,{result:e,type:"source"}),Object(be.jsx)("div",{className:"similarity-circle row justify-center align-center",children:Object(be.jsx)("div",{className:"similarity row justify-center align-center",children:Object(be.jsx)("span",{children:Math.round(e.similarity)+"%"})})}),Object(be.jsx)(at,{result:e,type:"target"})]},t)}))})},ct=Object(s.connect)((function(e){return{results:e.search.results,loading:e.search.resultsMeta.loading}}),(function(e){return{displayMoreResults:function(){return e((function(e,t){var n=t();n.search.maxDisplayed>=n.search.resultsMeta.totalResults||(e({type:"DISPLAY_MORE_SEARCH_RESULTS"}),e(G()))}))}}}))((function(e){var t=Object(F.a)({},e),n=t.results,r=t.loading,i=t.displayMoreResults,c=Object(a.useRef)();return Object(a.useEffect)((function(){var e=c.current;if(e){var t=Object(W.throttle)((function(){e.scrollTop/e.clientHeight>.75&&i()}),500);return c.current.addEventListener("scroll",t),function(){e&&e.removeEventListener("scroll",t)}}}),[i]),Object(be.jsxs)("div",{id:"results-container",className:"col align-center",children:[Object(be.jsx)(Ue,{}),Object(be.jsx)("div",{id:"result-pairs-container",ref:c,className:r?"flex-1 col justify-center":"flex-1 col",children:r?Object(be.jsx)(rt,{}):n&&n.length?Object(be.jsx)(it,{results:n}):Object(be.jsx)("span",{className:"no-results",children:"Sorry, no results could be found"})})]})})),st=n(4),ot={},lt=function(e){var t=Object.assign({},e);return t.margin=t.margin||{top:0,right:0,bottom:0,left:0},t.height=t.height||400,t.width=t.width||400,t};ot.createBase=function(e,t){var n=null,a=st.m(e).append("svg");t.xLabel&&a.append("text").attr("class","x label"),t.yLabel&&a.append("text").attr("class","y label");var r=a.append("g").attr("class","group-container");return t.drawGrid&&(r.append("rect").attr("class","grid"),r.append("g").attr("class","x grid"),r.append("g").attr("class","y grid")),r.append("g").attr("class","x axis"),r.append("g").attr("class","y axis"),t.onBrush&&(n=r.append("g").attr("class","brush")),t.areaData&&r.append("g").attr("class","area-container"),t.boxplotData&&r.append("g").attr("class","boxplot-container"),t.histogramData&&r.append("g").attr("class","histogram-container"),t.pointData&&r.append("g").attr("class","point-container"),t.lineData&&r.append("g").attr("class","line-container"),t.waffleData&&r.append("g").attr("class","waffle-container"),t.forceData&&r.append("g").attr("class","force-container"),t.swarmData&&r.append("g").attr("class","swarm-container"),t.legend&&r.append("g").attr("class","legend-container"),n},ot.updateBase=function(e,t){var n=lt(t),a=st.m(e).select("svg");ut(a,n),dt(a,n),ht(a,n),n.drawGrid&&ft(n),n.xLabel&&jt(a,n),n.yLabel&&bt(a,n)};var ut=function(e,t){t.resize?e.attr("viewBox","0 0 "+t.width+" "+t.height).attr("preserveAspectRatio","xMidYMid meet"):e.attr("width",t.width).attr("height",t.height)},dt=function(e,t){e.select(".group-container").attr("transform","translate("+t.margin.left+","+t.margin.top+")")},ht=function(e,t){e.select(".x.axis").attr("transform","translate(0,"+(t.height-t.margin.top-t.margin.bottom)+")")},ft=function(e){st.m(".group-container").select("rect.grid").attr("class","grid").attr("width",e.width-e.margin.left-e.margin.right).attr("height",e.height-e.margin.top-e.margin.bottom)},jt=function(e,t){e.select(".x.label").attr("text-anchor","middle").attr("y",t.height-t.margin.bottom+30).attr("x",t.width/2).attr("dy",".75em").text(t.xLabel)},bt=function(e,t){e.select(".y.label").attr("text-anchor","middle").attr("y",1).attr("x",0-(t.height-t.margin.bottom)/2).attr("dy",".75em").attr("transform","rotate(-90)").text(t.yLabel)};ot.getGeoms=function(e){var t=[];return e.pointData&&t.push({data:e.pointData,draw:ot.drawPoint}),e.waffleData&&t.push({data:e.waffleData,draw:ot.drawWaffle}),t},ot.getDomain=function(e,t){var n={};return n.x=st.e(e,(function(e){return e[t.x||"x"]})),n.y=st.e(e,(function(e){return e[t.y||"y"]})),t.xDomain&&(n.x=t.xDomain),t.yDomain&&(n.y=t.yDomain),n},ot.getScales=function(e,t,n){if(!n)return null;var a={},r=lt(t),i={x:[0,r.width-r.margin.right-r.margin.left],y:[r.height-r.margin.top-r.margin.bottom,0]};return Object.keys(i).map((function(e){if(r[e+"Scale"])switch(r[e+"Scale"]){case"ordinal":return a[e]=st.h().domain(n[e]).range(i[e]),null;case"linear":return a[e]=st.i().domain(n[e]).range(i[e]),null;case"inverse":return a[e]=st.i().domain(n[e]).range([i[e][1],i[e][0]]),null;default:console.warn("the requested",e,"scale is invalid")}else a[e]=st.i().domain(n[e]).range(i[e]);return null})),a},ot.updateAxes=function(e,t,n,a,r){if(n){!0===t.drawGrid&&ot.drawGrid(e,t,n);var i=ot.getAxes(t,n);st.m(e).selectAll("g.x.axis").call(i.x).selectAll("text").attr("y",(function(){return t.xLabelRotate?11:0})).attr("x",(function(){return t.xLabelRotate?1:0})).attr("dy",(function(){return t.xLabelRotate?".35em":0})).style("text-anchor",(function(){return t.xLabelRotate?"start":"middle"})).attr("transform",(function(){return t.xLabelRotate?"rotate("+t.xLabelRotate+")":"rotate(0)"})),st.m(e).selectAll("g.y.axis").transition().duration(1e3).call(i.y),a&&r&&(r.call(a),r.select(".overlay").attr("width",t.width-t.margin.left-t.margin.right).attr("height",t.height-t.margin.top-t.margin.bottom))}},ot.getAxes=function(e,t){return{x:st.a(t.x).ticks(e.xTicks).tickPadding(e.xTickPadding?e.xTickPadding:4).tickFormat(e.xTickFormat?e.xTickFormat:st.f("d")),y:st.b(t.y).ticks(e.yTicks).tickPadding(e.yTickPadding?e.yTickPadding:4).tickFormat(e.yTickFormat?e.yTickFormat:st.f(".1f"))}},ot.drawGrid=function(e,t,n){st.m(e).select(".x.grid").transition().duration(1e3).call(function(e){return st.a(n.x).ticks(e.xTicks||8)}(t).tickSize(t.height-t.margin.top-t.margin.bottom).tickFormat("")),st.m(e).select(".y.grid").transition().duration(1e3).call(function(e){return st.b(n.y).ticks(e.yTicks||8)}(t).tickSize(-(t.width-t.margin.left-t.margin.right)).tickFormat(""))},ot.drawPoint=function(e,t,n,a,r){var i=st.j("schemePaired"),c=t.x||"x",s=t.y||"y",o=t.jitter||!1;window.chartLib=window.chartLib||{},window.chartLib.jitters=window.chartLib.jitters||{x:[],y:[]},o||(window.chartLib.jitters={x:[],y:[]});var l=function(e,t){return t},u=function(e,t){return o?h(a.x(e[c]),t,"x"):a.x(e[c])},d=function(e,t){return o?h(a.y(e[s]),t,"y"):a.y(e[s])},h=function(e,t,n){return window.chartLib.jitters[n][t]||(window.chartLib.jitters[n][t]=30*Math.random()-15),e+window.chartLib.jitters[n][t]},f=st.m(e).select(".point-container").selectAll(".point-group").data(t.pointData,t.pointKey||l),j=f.enter().append("g").attr("class","point-group").on("mouseout",(function(e){return t.onMouseout?t.onMouseout(e):null})).on("mouseover",(function(e){return t.onMouseover?t.onMouseover(e):null})).on("mouseenter",(function(e){return t.onMouseenter?t.onMouseenter(e):null}));j.append("circle").attr("class","point"),j.append("text").attr("class","label").attr("stroke","#000"),f.merge(j).select(".point").transition().duration(1e3).delay((function(e,t){return 2*t})).attr("cx",u).attr("cy",d).attr("r",(function(e){return t.r?t.r:3})).attr("data-key",t.pointKey||l).style("fill",(function(e){return t.pointFill?t.pointFill(e):i(e.key)})).style("stroke",(function(e){return t.pointStroke?t.pointStroke(e):i(e.key)})),t.pointLabels&&f.merge(j).select(".label").transition().duration(1e3).text((function(e){return e.label?e.label:""})).attr("x",(function(e,t){return u(e,t)+6})).attr("y",(function(e,t){return d(e,t)-6})),f.exit().remove()},ot.drawWaffle=function(e,t,n,a){var r=t.waffleSize||10,i=t.maxColumn||10,c=t.levelMargin||10,s=st.m(e).select(".waffle-container").selectAll(".waffle").data(t.waffleData,(function(e){return e[t.waffleKey]||["waffle"]})),o=s.enter().append("rect").attr("class","waffle").attr("x",(function(e,t){return 10*t*Math.random()-10*Math.random()})).attr("y",0).on("click",(function(n,a){st.m(e).selectAll(".waffle").classed("active",!1),st.m(undefined).classed("active",!0),t.onClick&&t.onClick(n,a)}));s.merge(o).transition().duration(1e3).attr("x",(function(e,n){return a.x(e.xLevel)+e.column*r+((i-function(e){return t.columnCounts[e.xLevel]}(e))*r+c)/2})).attr("y",(function(e,n){var a=t.height-t.margin.bottom,i=(e.row+1)*r;return a-i})).attr("width",r).attr("height",r).attr("fill",(function(e,n){return t.color(e[t.colorKey])})).attr("stroke-width",1),s.exit().remove()};var pt=ot,mt=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(e){var a;return Object(ue.a)(this,n),(a=t.call(this,e)).state={brush:null},a.create=a.create.bind(Object(Oe.a)(a)),a.update=a.update.bind(Object(Oe.a)(a)),a.destroy=a.destroy.bind(Object(Oe.a)(a)),a}return Object(de.a)(n,[{key:"componentDidMount",value:function(){var e=c.a.findDOMNode(this);this.create(e,this.props)}},{key:"componentDidUpdate",value:function(e){var t=c.a.findDOMNode(this);this.update(t,this.props,this.state.brushElem)}},{key:"componentWillUnmount",value:function(){this.destroy(c.a.findDOMNode(this))}},{key:"create",value:function(e,t){var n=pt.createBase(e,t);this.update(e,t,n),this.setState({brushElem:n})}},{key:"update",value:function(e,t,n){var a,r,i;pt.updateBase(e,t),pt.getGeoms(t).map((function(n){return r=pt.getDomain(n.data,t),i=pt.getScales(e,t,r),n.draw(e,t,r,i),null})),t.onBrush&&t.setBrush&&(a=t.setBrush(n,i)),pt.updateAxes(e,t,i,a,n),t.legend&&pt.updateLegend(e,t)}},{key:"destroy",value:function(){}},{key:"render",value:function(){return Object(be.jsx)("div",{className:"chart"})}}]),n}(r.a.Component),gt=(Pe.a.shape({column:Pe.a.number.isRequired,row:Pe.a.number.isRequired,similarity:Pe.a.number.isRequired,xLevel:Pe.a.string.isRequired}),["#EFE0DB","#F5D66E","#F1A21A","#E6653E"]),vt=st.j().domain([50,67,84,100]).range(gt),yt=function(e,t){return t?parseInt(e)+"%":parseInt(e)},Ot=function(e){var t=e.domain&&e.domain[0]?e.domain[0]:50,n=e.domain&&e.domain[1]?e.domain[1]:100,a=!("percents"in e)||e.percents;return Object(be.jsxs)("div",{className:"chart-legend",children:[Object(be.jsx)("span",{children:yt(t,a)}),Object(be.jsx)("div",{className:"swatches",children:gt.map((function(e){return Object(be.jsx)("div",{className:"swatch",style:{background:e}},e)}))}),Object(be.jsx)("span",{children:yt(n,a)})]})},xt=n.p+"static/media/default-headshot.5ad2de77.jpg",Et=function(e){Object(he.a)(n,e);var t=Object(fe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(de.a)(n,[{key:"render",value:function(){var e=this;return Object(be.jsx)("div",{className:"waffle-card-wrapper",children:Object(be.jsxs)("div",{className:"waffle-card-container",children:[Object(be.jsxs)("div",{className:"waffle-card-controls",children:[Object(be.jsx)("span",{className:"label",children:"Visualize similar passages by:"}),Tt.map((function(t,n){return Object(be.jsx)(wt,{active:e.props.feature,feature:t.feature,label:t.label,setFeature:e.props.setFeature},n)})),Object(be.jsx)(Ot,{}),Object(be.jsx)(je.a,{to:"/",className:"close-visualization-wrapper",children:Object(be.jsx)("div",{className:"close-visualization"})})]}),Object(be.jsxs)("div",{className:"result waffle-chart-card",children:[Object(be.jsx)("div",{className:"result-top row align-center",children:Object(be.jsxs)("div",{className:"result-title",children:[Object(be.jsx)("span",{children:"All passages similar to "}),Object(be.jsx)("span",{children:Object(be.jsx)("i",{children:this.props.title})})]})}),Object(be.jsxs)("div",{className:"result-body row",children:[Object(be.jsxs)("div",{className:"headshot-container col justify-center align-center",children:[Object(be.jsx)("div",{className:"headshot",style:{backgroundImage:"url("+St(this.props.image)+")"}}),Object(be.jsx)("div",{className:"headshot-label",children:this.props.author})]}),Object(be.jsx)(Lt,{})]})]}),this.props.active?Object(be.jsx)(At,Object(F.a)({},this.props)):Object(be.jsx)("span",{})]})})}}]),n}(r.a.Component),wt=function(e){return Object(be.jsx)("div",{className:e.feature===e.active?"waffle-button active":"waffle-button",onClick:e.setFeature.bind(null,e.feature),children:e.label})},At=function(e){return Object(be.jsx)("div",{className:"waffle-card-result-container results-container",children:Object(be.jsxs)("div",{className:"result-pair row",children:[Object(be.jsx)(at,{type:e.type,result:e.active},"key-source"),Object(be.jsx)(at,{type:"source"===e.type?"target":"source",result:e.active},"key-target")]})})},St=function(e){return e?"src/"===e.substring(0,4)?e.substring(3):e:xt},Tt=[{feature:"author",label:"Author"},{feature:"segment_ids",label:"Segment"},{feature:"year",label:"Year"}],_t=function(e){return vt(parseInt(e))},It=function(e){return{data:e.waffle.data,width:e.waffle.width,xDomain:e.waffle.xDomain,columnCounts:e.waffle.columnCounts,maxColumn:e.waffle.maxColumn}},Rt=function(e){return{getActive:function(t,n){return e(function(e,t){return function(n){n(Ze(e,t))}}(t,n))}}},Lt=Object(s.connect)(It,Rt)((function(e){return Object(be.jsx)("div",{className:"waffle-chart hide-y-axis",children:e.data.length>0?Object(be.jsx)(mt,{height:236,margin:{top:0,right:80,bottom:75,left:0},xLabel:"",yLabel:"",xScale:"ordinal",xTickFormat:function(e){return e},xLabelRotate:25,yDomain:[1,20],waffleKey:"_id",colorKey:"similarity",color:_t,waffleData:e.data,width:e.width,columnCounts:e.columnCounts,maxColumn:e.maxColumn,x:e.feature,xDomain:e.xDomain,onClick:e.getActive}):Object(be.jsx)(rt,{})})}));It=function(e){return{type:e.waffle.type,feature:e.waffle.feature,author:e.waffle.author,title:e.waffle.title,image:e.waffle.image,data:e.waffle.data,active:e.waffle.active}},Rt=function(e){return{setFeature:function(t){return e(function(e){return function(t){t({type:"SET_WAFFLE_FEATURE",feature:e}),t(qe())}}(t))}}};var Dt=Object(s.connect)(It,Rt)(Et),kt=n(135),Ct=function(e){var t=Object(F.a)({},e),n=t.svg,a=t.data,r=t.setField,i=t.setTypeaheadQuery,c=t.fetchSearchResults,s={};a.links.map((function(e){return s[e.source]=s[e.source]?s[e.source]+1:1})),a.nodes.sort((function(e,t){var n=s[e.sankeyId]||0;return(s[t.sankeyId]||0)-n}));var o=10,l=210,u=10,d=210,h=900-d-l,f=30*a.nodes.length-o-u,j=st.l().domain([0,60,70,80]).range(gt);n=st.m(n).attr("width",h+d+l).attr("height",f+o+u).append("g").attr("transform","translate("+d+","+o+")");var b=Object(kt.a)().nodeId((function(e){return e.sankeyId})).nodeAlign(kt.b).nodeSort(null).nodeWidth(15).nodePadding(18).extent([[0,5],[h,f-5]]),p=b({nodes:a.nodes.map((function(e){return Object.assign({},e)})),links:a.links.map((function(e){return Object.assign({},e)}))}),m=p.nodes,g=p.links;n.append("g").attr("class","links").selectAll(".link").data(g.sort((function(e,t){return e.width-t.width}))).enter().append("path").attr("class",(function(e){return"link source-".concat(e.source.id," target-").concat(e.target.id)})).attr("fill","none").attr("d",Object(kt.c)()).style("stroke-width",(function(e){return Math.max(1,e.width)})).attr("stroke",(function(e){return j(e.similarity)})).on("click",(function(e){return function(e){i(""),r({earlierLater:"earlier",field:"fileId",value:e.source.id}),r({earlierLater:"later",field:"fileId",value:e.target.id}),c(),ie.push("/cards")}(e)})).append("title").text((function(e){return e.source.label+" \u2192\n"+e.target.label}));var v=function(e){e.sankeyId.includes("earlier")&&st.n(".link.source-".concat(e.id)).classed("active",!0),e.sankeyId.includes("later")&&st.n(".link.target-".concat(e.id)).classed("active",!0)},y=function(){st.n(".link").classed("active",!1)},O=n.append("g").attr("class","nodes").selectAll(".node").data(m).enter().append("g").attr("class","node").attr("transform",(function(e){return"translate("+e.x0+","+e.y0+")"}));O.append("rect").attr("height",(function(e){return e.y1-e.y0})).attr("width",b.nodeWidth()).style("fill",(function(e){return"#f3f3f3"})).style("stroke",(function(e){return"#999999"})).on("mouseenter",v).on("mouseout",y).append("title").text((function(e){return e.label})),O.append("foreignObject").attr("class",(function(e){return e.sankeyId.includes("earlier")?"earlier":"later"})).attr("x",(function(e){return e.sankeyId.includes("earlier")?-205:20})).attr("y",(function(e){return e.y1-e.y0>=20?0:-(20-(e.y1-e.y0))/2})).attr("width",200).attr("height",(function(e){return Math.max(e.y1-e.y0,20)})).append("xhtml:body").attr("xmlns","http://www.w3.org/1999/xhtml").attr("class",(function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?"":"center-vertically"})).text((function(e){return e.label.length<25?e.label:e.label.substring(0,25)+"..."})).on("mouseenter",v).on("mouseout",y)},Nt=Object(s.connect)((function(e){return{typeaheadField:e.typeahead.field,labelToFileIds:e.typeahead.fileIds?e.typeahead.fileIds[e.typeahead.field]:null,sortIndex:e.search.sortIndex}}),(function(e){return{fetchSearchResults:function(){return e(q())},setTypeaheadQuery:function(t){return e(Y(t))},setField:function(t){return e(J(t))}}}))((function(e){var t=Object(a.useRef)(),n=Object(a.useState)(!1),r=Object(N.a)(n,2),i=r[0],c=r[1];return Object(a.useEffect)((function(){if(!i&&e.sortIndex&&e.labelToFileIds){c(!0);var n=function(e,t){if(e&&0!==Object.values(e).length&&t&&0!==Object.values(t).length){for(var n={},a=function(){var e=Object(N.a)(i[r],2),t=e[0];e[1].forEach((function(e){n[e]=t}))},r=0,i=Object.entries(t);r<i.length;r++)a();var c={};e.forEach((function(e){var t=$(e);c[t.earlierId]=c[t.earlierId]||[],c[t.earlierId].push(t.laterId)}));var s={},o={};e.forEach((function(e){var t=$(e),a=t.earlierId,r=t.laterId,i=n[a],c=n[r],l="earlier-"+a.toString(),u="later-"+r.toString(),d={id:a,label:i,sankeyId:l},h={id:r,label:c,sankeyId:u};s[l]=d,s[u]=h,o[l]=o[l]||{},o[l][u]=o[l][u]||{count:0,similarity:[]},o[l][u].count+=1,o[l][u].similarity.push(t.similarity)}));var l=[];return Object.keys(o).forEach((function(e){Object.keys(o[e]).forEach((function(t){l.push({source:e,target:t,similarity:W.mean(o[e][t].similarity),count:o[e][t].count,value:o[e][t].count})}))})),{nodes:Object.values(s),links:l}}}(e.sortIndex,e.labelToFileIds);Ct({svg:t.current,data:n,setField:e.setField,setTypeaheadQuery:e.setTypeaheadQuery,fetchSearchResults:e.fetchSearchResults})}}),[i,e.sortIndex,e.labelToFileIds,e.setField,e.setTypeaheadQuery,e.fetchSearchResults]),Object(be.jsx)("div",{className:"sankey-wrap",children:Object(be.jsx)("svg",{ref:t,id:"sankey-plot"})})})),Ft=function(){return function(e,t){e({type:"FETCH_SCATTERPLOT_RESULTS"});var n=Mt(t()),a=n.use,r=n.unit,i=n.stat;return V("/api/scatterplots/".concat(a,"-").concat(r,"-").concat(i,".json")).then((function(n){var a=t(),r=a.scatterplot.yDomains,i=a.scatterplot.xDomain,c=n.filter((function(e){if(r&&2===r.length){var t=st.e(r),n=Object(N.a)(t,2),a=n[0],c=n[1],s=e.target_year;if(s<a||s>c)return!1}if(2===i.length){var o=st.e(i),l=Object(N.a)(o,2),u=l[0],d=l[1],h=e.similarity;if(h<u||h>d)return!1}return!0}));e(Ut(c))})).catch((function(t){e({type:"SCATTERPLOT_REQUEST_FAILED"})}))}},Mt=function(e){return{use:Ht(e.scatterplot.use),unit:Vt(e.scatterplot.unit),stat:e.scatterplot.statistic}},Ht=function(e){return"earlier"===e?"target":"source"},Vt=function(e){return"passage"===e?"segment_ids":"author"===e?"author":"book"===e?"file_id":"segment_ids"},Ut=function(e,t){return function(t,n){for(var a=n(),r=function(e,t){return{x:st.e(e,(function(e){return e.similarity})),y:st.e(e,(function(e){return e[Ht(t.use)+"_year"]}))}}(e,a.scatterplot),i=0;i<20;i++)try{e[i].label=i+1}catch(s){}var c={data:e,xDomain:r.x,yDomain:r.y,zoomed:!1};t({type:"RECEIVE_SCATTERPLOT_RESULTS",obj:c})}},Wt=function(e){return Object(be.jsxs)(be.Fragment,{children:[Object(be.jsxs)("h1",{children:["Popular ",e.unit,"s"]}),Object(be.jsxs)("div",{children:[Object(be.jsx)("span",{children:"The chart below displays the most popular "}),Object(be.jsxs)("span",{children:[e.unit,"s "]}),Object(be.jsx)("span",{children:"within your corpus. Hover over individual points for more information."})]})]})},Pt=function(e){return Object(be.jsxs)("div",{className:"controls",children:[Object(be.jsx)("span",{children:"Show "+e.unit+"s most similar to"}),Object(be.jsxs)("select",{onChange:e.setUse,value:e.use,children:[Object(be.jsx)("option",{value:"earlier",children:"Earlier"}),Object(be.jsx)("option",{value:"later",children:"Later"})]}),Object(be.jsx)("span",{children:e.unit+"s based on"}),Object(be.jsxs)("select",{onChange:e.setStatistic,value:e.statistic,children:[Object(be.jsx)("option",{value:"sum",children:"Sum"}),Object(be.jsx)("option",{value:"mean",children:"Mean"})]}),Object(be.jsx)("span",{children:"of passage similarity"})]})},Yt=function(e){return Object(be.jsxs)("div",{className:"left",children:[Object(be.jsx)(zt,Object(F.a)({},e)),Object(be.jsx)(Jt,Object(F.a)({},e))]})},Bt=function(e){return Object(be.jsxs)("div",{className:"col",children:[e.tooltip.title?Object(be.jsx)(Zt,Object(F.a)({},e)):null,Object(be.jsx)(qt,Object(F.a)({},e)),Object(be.jsx)("div",{className:"controls-lower",children:Object(be.jsx)("div",{className:e.zoomed?"reset-button visible":"reset-button",onClick:e.resetZoom,children:"Reset zoom"})})]})},zt=function(e){return Object(be.jsxs)("div",{className:"row align-center",children:[Object(be.jsx)("span",{className:"swatch-label",children:"Similarity"}),Object(be.jsx)(Ot,{domain:e.xDomain,percents:"mean"===e.statistic}),Object(be.jsxs)("div",{className:"jitter row align-center",children:[Object(be.jsx)("span",{children:"Jitter"}),Object(be.jsx)("input",{type:"checkbox",onChange:e.toggleJitter,value:e.jitter})]})]})},Jt=function(e){var t=function(t,n,a){if(st.d.sourceEvent&&st.d.selection){var r=[t.x.invert(st.d.selection[0][0]),t.x.invert(st.d.selection[1][0])],i=[t.y.invert(st.d.selection[0][1]),t.y.invert(st.d.selection[1][1])];e.data.filter((function(t){return t.similarity>=r[0]&&t.similarity<=r[1]&&t[e.y]>=i[0]&&t[e.y]<=i[1]})).length?e.setDomains({x:r,y:i}):e.resetZoom(),a.call(n.move,null)}},n=st.k().domain(e.xDomain).range(gt);return 0===e.data.length?Object(be.jsx)("div",{className:"col flex-1 justify-center align-center",children:Object(be.jsx)(rt,{})}):Object(be.jsx)(mt,{width:480,height:600,margin:{top:15,right:20,bottom:20,left:40},pointData:e.data,pointStroke:function(e){return"#fff"},pointFill:function(e){return n(e.similarity)},pointLabels:!0,pointKey:function(e){return e.key},jitter:e.jitter,r:8,x:"similarity",xTicks:7,xDomain:e.xDomain,xTickFormat:function(e){return Math.round(e)/100},y:e.y,yTicks:5,yScale:"inverse",yDomain:e.yDomain,yTickFormat:function(e){return parseInt(e)},drawGrid:!0,setBrush:function(e,n){var a=st.c();return a.on("end",(function(){t(n,a,e)}))},onBrush:t,resize:!1,onMouseover:function(t){var n=st.m(".scatterplot-container").node(),a=st.g(n);e.setTooltip({x:a[0],y:a[1],title:t.title,author:t.author,year:t[e.y]})},onMouseout:function(t){e.setTooltip({x:null,y:null,title:"",author:"",year:null})}})},Zt=function(e){return Object(be.jsxs)("div",{className:"tooltip",style:{left:e.tooltip.x+5,top:e.tooltip.y+30},children:[Object(be.jsx)("div",{className:"title",children:e.tooltip.title}),Object(be.jsx)("div",{className:"author",children:e.tooltip.author+", "+e.tooltip.year})]})},qt=function(e){return Object(be.jsxs)("div",{className:"right",children:[Object(be.jsxs)("div",{className:"scatterplot-label",children:[Object(be.jsxs)("span",{children:["Top ",Math.min(20,e.data.length)," most popular "]}),Object(be.jsxs)("span",{children:[e.unit,"s "]}),Object(be.jsx)("span",{children:"in current view"})]}),Object(be.jsx)("div",{className:"clear-both"}),Object(be.jsx)("hr",{}),Object(be.jsx)("table",{children:Object(be.jsx)("tbody",{children:e.data.slice(0,20).map((function(t,n){return Object(be.jsx)(Gt,{unit:e.unit,row:t},n)}))})})]})},Gt=function(e){return Object(be.jsxs)("tr",{className:"book",children:[Object(be.jsxs)("td",{className:"book-number",children:[e.row.label,"."]}),Object(be.jsx)("td",{dangerouslySetInnerHTML:Xt(e)})]})},Xt=function(e){switch(e.unit){case"passage":return{__html:"..."+e.row.match.split(" ").slice(0,20).join(" ")+"..."};case"author":return{__html:e.row.author};case"book":return{__html:e.row.title};default:return""}},Qt=Object(s.connect)((function(e){return{unit:e.scatterplot.unit,statistic:e.scatterplot.statistic,use:e.scatterplot.use,jitter:e.scatterplot.jitter,y:e.scatterplot.y,data:e.scatterplot.data,tooltip:e.scatterplot.tooltip,xDomain:e.scatterplot.xDomain,yDomain:e.scatterplot.yDomain,zoomed:e.scatterplot.zoomed}}),(function(e){return{setY:function(t){return e(function(e){return{type:"SET_Y",y:e}}(t))},setUse:function(t){return e((n=t.target.value,function(e){e({type:"SET_USE",use:n}),e(Ft())}));var n},setUnit:function(t){return e(function(e){return function(t){t({type:"SET_UNIT",unit:e}),t(Ft())}}(t))},setStatistic:function(t){return e((n=t.target.value,function(e){e({type:"SET_STATISTIC",statistic:n}),e(Ft())}));var n},setTooltip:function(t){return e(function(e){return{type:"SET_TOOLTIP",obj:e}}(t))},resetZoom:function(){return e((function(e){e(Ft())}))},toggleJitter:function(){return e({type:"TOGGLE_JITTER"})},setDomains:function(t){return e((n=t,function(e,t){e({type:"SET_DOMAINS",domains:n}),e(Ft())}));var n}}}))((function(e){return Object(be.jsx)("div",{className:"scatterplot-container flex-1",children:Object(be.jsxs)("div",{className:"scatterplot hide-x-grid flex-1",children:[Object(be.jsx)(Wt,Object(F.a)({},e)),Object(be.jsx)(Pt,Object(F.a)({},e)),Object(be.jsxs)("div",{className:"row align-start justify-center",children:[Object(be.jsx)(Yt,Object(F.a)({},e)),Object(be.jsx)(Bt,Object(F.a)({},e))]})]})})})),Kt=Object(s.connect)((function(e){return{metadata:e.typeahead.metadata||[]}}),(function(e){return{setSearchLoading:function(t){return e(re(t))},setTypeaheadQuery:function(t){return e(Y(t))},setTypeaheadField:function(t){return e(P(t))},clearAdvancedFilterType:function(t){return e(Z(t))},fetchSearchResults:function(){return e(q())}}}))((function(e){var t=Object(W.orderBy)(e.metadata,"author");return Object(be.jsxs)("div",{id:"page-works",children:[Object(be.jsx)("h1",{children:"Works"}),Object(be.jsx)("div",{children:t.map((function(t,n){return Object(be.jsxs)("div",{className:"work-row row align-center",children:[Object(be.jsxs)("div",{className:"work-author",children:[t.author,", "]}),t.matches?Object(be.jsx)(je.a,{to:"/cards",onClick:function(n){return function(t,n){n.preventDefault(),e.clearAdvancedFilterType("earlier"),e.clearAdvancedFilterType("later"),e.setTypeaheadField("title"),e.setTypeaheadQuery(t),e.fetchSearchResults(),ie.push("/cards")}(t.title,n)},children:t.title}):Object(be.jsx)("div",{className:"work-title",children:t.title})]},n)}))})]})})),$t=function(e){var t,n=Object(F.a)({},e),a=n.r,r=n.ridx,i=function(e,t){var n=new Set,a=[];return e.forEach((function(e){(e.windows||[]).forEach((function(e){t[e]&&t[e].forEach((function(e){n.has(e._id)||(n.add(e._id),a.push(e))}))}))})),a}(a,n.matchMap),c=a.filter((function(e){return e.windows&&e.windows.length})).length>0,s=st.i().domain([0,10]).range(["#eee","#444"]);return Object(be.jsxs)("div",{className:function(t){var n="row space-between";return null!==e.selectedRow.idx&&(Math.abs(e.selectedRow.idx-e.ridx)<5?n+=" selected-context":n+=" not-selected"),e.selectedRow.idx===e.ridx&&(n+=" selected"),n+=t?" selectable":" not-selectable"}(c),onClick:function(t){return i.length?function(t,n){e.setSelectedRow({idx:t,matches:n})}(r,i):null},children:[Object(be.jsx)("div",{className:"line",dangerouslySetInnerHTML:{__html:(t=a,t.map((function(e){return e.word})).join(" "))}}),Object(be.jsx)("div",{className:"match-count",style:{background:s(c?Math.min(i.length,10):0)}})]})},en=function(e){if(e.fileId){var t={},n=parseInt(e.fileId);return e.matches.forEach((function(e){(parseInt(e.source_file_id)===n?e.source_segment_ids:e.target_segment_ids).forEach((function(n){t[n]=t[n]||[],t[n].push(e)}))})),t}},tn=function(e,t){var n=[],a=[],r=-1;(t.words||[]).forEach((function(e,i){for(i%t.config.window_slide===0&&r++,a.length&&a[a.length-1]===r||a.push(r),i>=a[0]*t.config.window_slide+t.config.window_size&&(a=a.slice(1)),n.push({word:e.replaceAll("<br/>",""),windows:a.slice(0)});e.includes("<br/>");)e=e.replace("<br/>",""),n.push({word:"<br/>",windows:null})}));var i=[];if(e&&e.current){var c=e.current;c.innerHTML="",c.style.position="absolute",c.style.top="-1000%",c.style.left="-1000%",c.classList.add("viewer-text-column");for(var s=[],o=0,l="",u=0;u<n.length;u++)l+=n[u].word+" ",c.innerHTML=l,c.clientHeight!==o&&(o=c.clientHeight,i.push(s),s=[]),s.push(n[u])}return i},nn=function(e){var t=e.otherId===e.m.source_file_id.toString();return Object(be.jsx)("div",{className:"match-row",children:Object(be.jsx)(at,{result:e.m,type:t?"source":"target",headerRight:!0})})},an=Object(s.connect)((function(e){return{words:e.viewer.words,matches:e.viewer.matches,fileId:e.viewer.fileId||"",config:e.search.config}}),(function(e){return{getViewerData:function(t){return e(function(e){return function(t){var n;Promise.all([t((n=e,function(e,t){var a=t(),r="words/".concat(n,".json");return r in a.cache?new Promise((function(e,t){return e(a.cache[r])})):ne(n.toString()).then((function(t){return e(U(r,t)),t}))})),t(te(e))]).then((function(n){var a=Object(N.a)(n,2),r=a[0],i=a[1];t({type:"SET_VIEWER_DATA",fileId:e,matches:i,words:r})}))}}(t))}}}))((function(e){var t=Object(a.useRef)(),n=Object(a.useState)([]),r=Object(N.a)(n,2),i=r[0],c=r[1],s=Object(a.useState)({}),o=Object(N.a)(s,2),l=o[0],u=o[1],d=Object(a.useState)({idx:null,matches:[]}),h=Object(N.a)(d,2),f=h[0],j=h[1],b=e.match.params.id.toString()===e.fileId.toString()&&i.length;return Object(a.useEffect)((function(){e.getViewerData(e.match.params.id),c(tn(t,e)),u(en(e))}),[e,e.match.params.id,e.fileId,e.matches]),Object(be.jsxs)("div",{id:"page-viewer",className:"row justify-center",children:[Object(be.jsx)("div",{id:"offscreen",ref:t}),b?Object(be.jsxs)("div",{id:"viewer-text-columns",children:[Object(be.jsx)("div",{id:"viewer-left",className:"viewer-text-column",children:i.map((function(e,t){return Object(be.jsx)($t,{r:e,ridx:t,selectedRow:f,matchMap:l,setSelectedRow:j},t)}))}),Object(be.jsx)("div",{id:"viewer-right",className:"viewer-text-column",children:f.matches.length?f.matches.map((function(t,n){return Object(be.jsx)(nn,{m:t,otherId:e.fileId.toString()},n)})):null})]}):Object(be.jsx)("div",{className:"col align-center justify-center",children:Object(be.jsx)(rt,{})})]})})),rn=Object(be.jsx)(ye,{children:Object(be.jsxs)(le.Switch,{children:[Object(be.jsx)(le.Route,{path:"/sankey",component:Nt}),Object(be.jsx)(le.Route,{path:"/waffle",component:Dt}),Object(be.jsx)(le.Route,{path:"/scatterplot",component:Qt}),Object(be.jsx)(le.Route,{path:"/works",component:Kt}),Object(be.jsx)(le.Route,{path:"/cards",component:ct}),Object(be.jsx)(le.Route,{path:"/viewer/:id",component:an}),Object(be.jsx)(le.Route,{exact:!0,path:"/",component:ct,children:Object(be.jsx)(le.Redirect,{to:"cards"})})]})});n(532),n(533),n(534),n(535),n(536),n(537),n(538),n(539),n(540),n(541),n(542),n(543),n(544),n(545),n(546),n(547),n(548),n(549),n(550);c.a.render(Object(be.jsx)(s.Provider,{store:oe,children:Object(be.jsx)(l.ConnectedRouter,{history:ie,children:rn})}),document.getElementById("root"))}},[[551,1,2]]]);
//# sourceMappingURL=main.1ffe21d0.chunk.js.map