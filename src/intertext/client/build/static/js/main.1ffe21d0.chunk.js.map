{"version":3,"sources":["reducers/waffleReducer.js","reducers/searchReducer.js","reducers/favoriteReducer.js","reducers/typeaheadReducer.js","reducers/scatterplotReducer.js","reducers/viewerReducer.js","reducers/cacheReducer.js","reducers/index.js","actions/favorite.js","actions/ajax.js","actions/cache.js","actions/typeahead.js","actions/search.js","store.js","components/partials/Header.jsx","assets/images/intertext.png","assets/images/yale-mark.svg","components/partials/Footer.jsx","components/App.jsx","components/filters/SortResults.jsx","components/cards/ResultCount.jsx","components/typeahead/TypeaheadResults.jsx","components/typeahead/Typeahead.jsx","components/typeahead/TypeaheadSelect.jsx","assets/images/icons/filter-icon.svg","components/filters/AdvancedFilters.jsx","components/filters/Filters.jsx","actions/waffle.js","components/cards/icons/ReadIcon.jsx","components/cards/icons/FavoriteIcon.jsx","components/cards/icons/VisualizeIcon.jsx","components/cards/Card.jsx","components/partials/Loader.jsx","components/cards/Cards.jsx","components/charts/lib/chart-lib.js","components/charts/Chart.jsx","components/charts/lib/color-lib.js","components/charts/Legend.jsx","assets/images/authors/default-headshot.jpg","components/charts/Waffle.jsx","components/charts/lib/sankey-lib.js","components/charts/Sankey.jsx","actions/scatterplot.js","components/charts/Scatterplot.jsx","components/works/Works.jsx","components/viewer/Viewer.jsx","actions/viewer.js","routes.js","index.js"],"names":["initialState","feature","data","xDomain","width","columnCounts","active","matches","type","file_id","author","title","image","err","waffleReducer","state","action","Object","assign","displayed","visible","url","obj","maxColumn","levelMargin","defaultAdvanced","fileId","changed","results","allResults","maxDisplayed","sortField","sortIndex","config","advanced","similarity","displayedSimilarity","length","displayedLength","earlier","later","resultsMeta","loading","totalResults","getSharedChangeCount","count","forEach","f","toString","searchReducer","t","earlierLater","field","val","value","parseInt","col","keys","key","update","newMax","slice","bool","docs","total","infiles","window_size","window_slide","source","target","favoriteReducer","_id","filter","m","query","index","fileIds","metadata","typeaheadReducer","toLowerCase","unit","use","statistic","yDomain","y","zoomed","jitter","tooltip","x","scatterplotReducer","stat","domains","yDomains","words","reducer","cacheReducer","keyValuePair","rootReducer","combineReducers","search","favorites","typeahead","scatterplot","waffle","viewer","viewerReducer","cache","addFavorite","removeFavorite","saveFavorites","dispatch","getState","localStorage","setItem","JSON","stringify","console","warn","fetchJSONFile","base","window","location","href","split","replace","substring","fetch","then","response","status","Error","json","addCacheRecord","setTypeaheadField","setTypeaheadQuery","setTypeaheadIndex","fetchSortIndex","trim","catch","e","setAdvancedFilterField","clearAdvancedFilterType","fetchSearchResults","setSearchLoading","runSearch","resetMaxDisplayedSearchResults","scrollToCardsTop","fetchMoreSearchResults","Promise","all","fileIdx","concat","v","filteredSortIndex","getFilteredSortIndex","orderedIndex","matchFileIDs","uniq","map","d","getMatchFiles","matchFiles","reduce","arr","i","matchIndex","matchFileId","push","indexOf","elem","document","querySelector","scrollTo","getValuesOfMatchingKeys","q","s","Set","k","includes","add","getEarlierOrLaterFileIds","Number","isInteger","getSetIntersection","sets","a","b","c","has","filterFileIds","either","item","row","parseSortIndexRow","earlierId","laterId","id","probability","matchFileID","getMatchFile","cacheKey","resolve","reject","fetchMatchFile","match","fetchWordsFile","textID","history","createHashHistory","middlewares","createLogger","thunkMiddleware","routerMiddleware","middleware","applyMiddleware","store","createStore","connectRouter","getItem","parse","routes","route","label","connect","router","pathname","props","className","to","src","alt","r","style","Footer","mark","React","Component","AppWrapper","this","children","SortResults","handleChange","bind","setSortAndSearch","onChange","disabled","TypeaheadResults","handleMousedown","handleMouseup","addEventListener","removeEventListener","stopPropagation","preventDefault","getAttribute","blur","result","idx","onClick","submitSearch","Result","data-value","ref","useRef","phrase","current","onKeyUp","keyCode","TypeaheadSelect","event","Range","Slider","createSliderWithTooltip","AdvancedFilters","setLength","setDisplayedLength","setSimilarity","setDisplayedSimilarity","clearAdvanced","clearInputs","open","selectionCount","refProp","min","max","step","onAfterChange","AdvancedFilterColumn","useState","dirty","setDirty","setField","buttonClass","titleCase","defaultValue","clearColumn","AdvancedFilterInput","querySelectorAll","toUpperCase","searchActions","childRef","setOpen","useEffect","onWindowClick","contains","iconClassName","filterIcon","saveWaffleInUrl","requestWaffleActiveData","plotWaffle","margin","getCellData","cols","maxCol","cells","counts","level","source_file_id","Math","floor","column","xLevel","ReadIcon","xmlns","viewBox","transform","FavoriteIcon","VisualizeIcon","height","Card","getText","favorite","visualize","getFavoriteClass","prefix","__html","toggleFavorite","headerRight","dangerouslySetInnerHTML","rel","HeaderLeft","HeaderRight","PropTypes","shape","number","isRequired","source_author","string","source_filename","source_match","source_postmatch","source_prematch","source_segment_ids","arrayOf","source_title","source_url","source_year","target_author","target_file_id","target_file_path","target_filename","target_match","target_postmatch","target_prematch","target_segment_ids","target_title","target_url","target_year","compare","setWaffleVisualized","Loader","CardPairs","round","displayMoreResults","onScroll","throttle","scrollTop","clientHeight","ChartLib","curateProps","_props","top","right","bottom","left","createBase","brushElem","svg","d3","append","xLabel","attr","yLabel","g","drawGrid","onBrush","areaData","boxplotData","histogramData","pointData","lineData","waffleData","forceData","swarmData","legend","updateBase","select","setSvgSize","transformGroupContainer","transformXAxis","addGrid","addXLabel","addYLabel","resize","text","getGeoms","geoms","draw","drawPoint","drawWaffle","getDomain","domain","getScales","scales","axes","range","updateAxes","brush","getAxes","selectAll","call","xLabelRotate","transition","duration","ticks","xTicks","tickPadding","xTickPadding","tickFormat","xTickFormat","yTicks","yTickPadding","yTickFormat","gridX","tickSize","gridY","jitters","color","xKey","yKey","j","chartLib","dataKey","dim","random","points","pointKey","pointsEnter","enter","on","onMouseout","onMouseover","onMouseenter","merge","delay","pointFill","pointStroke","pointLabels","exit","remove","size","waffleSize","waffleKey","waffleEnter","classed","colCount","offset","colorKey","Chart","create","destroy","el","ReactDOM","findDOMNode","prevProps","setState","geom","setBrush","updateLegend","colors","colorScale","percents","Legend","background","Waffle","options","o","setFeature","backgroundImage","getImage","WafflePlot","Button","WaffleCards","headshot","colorCell","mapStateToProps","mapDispatchToProps","getActive","getWaffleActive","xScale","setWaffleFeature","plot","links","nodes","sort","ca","sankeyId","linkColor","sankey","d3sankey","nodeId","nodeAlign","d3sankeyCenter","nodeSort","nodeWidth","nodePadding","extent","d3sankeyLinkHorizontal","handleLinkClick","activateLinks","deactivateLinks","node","x0","y0","y1","test","navigator","userAgent","typeaheadField","labelToFileIds","typeaheadActions","initialized","setInitialized","values","fileIdToLabel","entries","matchIdMap","aLabel","bLabel","sankeyIdA","sankeyIdB","aNode","bNode","l","_","getData","fetchScatterplotResults","getScatterplotProps","filteredResults","minYear","maxYear","itemYear","minX","maxX","itemSimiliarty","parseResults","getUse","getUnit","_state","getDomains","args","IntroText","Controls","setUse","setStatistic","Left","Right","resetZoom","LeftControls","toggleJitter","LeftChart","handleBrush","sourceEvent","selection","invert","setDomains","move","yScale","container","mouseLocation","setTooltip","year","Tooltip","Table","Row","getRowText","join","setY","setUnit","sorted","orderBy","TextRow","ridx","matchMap","ids","windows","w","getRowMatches","hasWindows","selectedRow","abs","getClassName","setSelectedRow","word","getMatchMap","getRows","offscreenRef","windowIndex","wordIndex","replaceAll","rows","offscreen","innerHTML","position","classList","MatchRow","isSource","otherId","getViewerData","viewerActions","setRows","setMatchMap","loaded","params","midx","path","component","Sankey","Scatterplot","Works","Cards","Viewer","exact","render","getElementById"],"mappings":"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","file":"static/js/main.1ffe21d0.chunk.js","sourcesContent":["const initialState = {\n  feature: 'author', // 'author' || 'segment_ids' || 'year'\n  data: [],\n  xDomain: [],\n  width: 0, // width of the chart\n  columnCounts: {},\n  active: null, // the waffle cell the user clicked on most recently\n  matches: [], // array of the matches for the clicked file id\n  type: '', // 'source' || 'target'\n  file_id: '', // file_id of the selected passage\n  author: '', // author of the selected passage\n  title: '', // title of the selected passage\n  image: null, // path to image of author of the selected passage\n  err: null,\n};\n\nconst waffleReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'SET_WAFFLE_VISIBILITY':\n      return Object.assign({}, state, {\n        displayed: action.visible,\n      });\n\n    case 'SET_WAFFLE_FEATURE':\n      return Object.assign({}, state, {\n        feature: action.feature,\n      });\n\n    case 'WAFFLE_IMAGE_REQUEST_FAILED':\n      return Object.assign({}, state, {\n        err: true,\n      });\n\n    case 'RECEIVE_WAFFLE_IMAGE':\n      return Object.assign({}, state, {\n        image: action.url,\n      });\n\n    case 'SET_WAFFLE_VISUALIZED':\n      return Object.assign({}, state, {\n        type: action.obj.type,\n        title: action.obj[action.obj.type + '_title'],\n        file_id: action.obj[action.obj.type + '_file_id'],\n        author: action.obj[action.obj.type + '_author'],\n        active: null,\n      });\n\n    case 'SET_WAFFLE_DATA':\n      return Object.assign({}, state, {\n        data: action.obj.data,\n        xDomain: action.obj.xDomain,\n        feature: action.obj.feature,\n        width: action.obj.width,\n        columnCounts: action.obj.columnCounts,\n        maxColumn: action.obj.maxColumn,\n        levelMargin: action.obj.levelMargin,\n        matches: action.obj.matches,\n      });\n\n    case 'SET_WAFFLE_ACTIVE':\n      return Object.assign({}, state, {\n        active: action.obj,\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport default waffleReducer;\n","const maxDisplayedStep = 10;\n\nexport const defaultAdvanced = {\n  title: '',\n  author: '',\n  fileId: '',\n  changed: 0,\n};\n\nexport const initialState = {\n  results: [],\n  allResults: [],\n  maxDisplayed: maxDisplayedStep,\n\n  // sort\n  sortField: 'length',\n  sortIndex: null,\n\n  // config\n  config: {},\n\n  // advanced filters\n  advanced: {\n    similarity: [1, 100],\n    displayedSimilarity: [1, 100],\n    length: [1, 25],\n    displayedLength: [1, 25],\n    changed: 0,\n    earlier: defaultAdvanced,\n    later: defaultAdvanced,\n  },\n\n  // metadata associated with search results\n  resultsMeta: {\n    err: false,\n    loading: true,\n    totalResults: 0,\n  },\n};\n\nconst searchReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'RESET_SEARCH':\n      return Object.assign({}, state, initialState);\n\n    case 'SET_SORT_FIELD':\n      return Object.assign({}, state, {\n        sortField: action.sortField,\n      });\n\n    case 'SET_SORT_ORDER_INDEX':\n      return Object.assign({}, state, {\n        sortIndex: action.sortIndex,\n      });\n\n    case 'SET_ADVANCED_FILTER':\n      const t = action.earlierLater;\n      const field = action.field;\n      // convert types here\n      const val =\n        action.field === 'fileId' ? (action.value ? parseInt(action.value) : '') : action.value;\n      // set the new earlier/later field values\n      let col = Object.assign({}, state.advanced[t], {\n        [field]: val,\n      });\n      // identify the number of fields that have changed\n      let count = 0;\n      Object.keys(defaultAdvanced).forEach(function (key) {\n        if (key !== 'changed') {\n          if (defaultAdvanced[key] !== col[key]) count++;\n        }\n      });\n      col.changed = count;\n      // update the advanced column state\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          [t]: col,\n        }),\n      });\n\n    case 'SET_ADVANCED_FILTER_LENGTH': {\n      // identify the number of shared filter fields that have changed\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          length: action.val,\n        }),\n      });\n    }\n\n    case 'SET_ADVANCED_FILTER_DISPLAYED_LENGTH': {\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          displayedLength: action.val,\n        }),\n      });\n    }\n\n    case 'SET_ADVANCED_FILTER_SIMILARITY': {\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          similarity: action.val,\n        }),\n      });\n    }\n\n    case 'SET_ADVANCED_FILTER_DISPLAYED_SIMILARITY': {\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          displayedSimilarity: action.val,\n        }),\n      });\n    }\n\n    case 'SET_ADVANCED_FILTER_CHANGE_COUNT': {\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          changed: getSharedChangeCount(state),\n        }),\n      });\n    }\n\n    case 'CLEAR_ADVANCED_FILTER_TYPE':\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          [action.earlierLater]: defaultAdvanced,\n        }),\n      });\n\n    case 'CLEAR_ADVANCED_FILTERS':\n      return Object.assign({}, state, {\n        advanced: Object.assign({}, initialState.advanced),\n      });\n\n    case 'LOAD_SEARCH_FROM_URL':\n      let update = Object.assign({}, state, {\n        advanced: Object.assign({}, state.advanced, {\n          earlier: action.obj.earlier ? action.obj.earlier : state.advanced.earlier,\n          later: action.obj.later ? action.obj.later : state.advanced.later,\n        }),\n      });\n      return Object.assign({}, state, update);\n\n    case 'DISPLAY_MORE_SEARCH_RESULTS':\n      const newMax = state.maxDisplayed + maxDisplayedStep;\n      return Object.assign({}, state, {\n        maxDisplayed: newMax,\n        results: state.allResults.slice(0, newMax),\n      });\n\n    case 'RESET_MAX_DISPLAYED_SEARCH_RESULTS':\n      return Object.assign({}, state, {\n        maxDisplayed: maxDisplayedStep,\n      });\n\n    case 'SET_SEARCH_LOADING':\n      return Object.assign({}, state, {\n        resultsMeta: Object.assign({}, state.resultsMeta, {\n          loading: action.bool,\n        }),\n      });\n\n    case 'SET_ALL_SEARCH_RESULTS':\n      return Object.assign({}, state, {\n        results: action.docs,\n        allResults: action.docs,\n        resultsMeta: Object.assign({}, state.resultsMeta, {\n          totalResults: action.total,\n          err: action.err,\n          loading: false,\n        }),\n      });\n\n    case 'SET_SEARCH_RESULTS':\n      return Object.assign({}, state, {\n        results: action.results,\n      });\n\n    case 'SET_CONFIG':\n      return Object.assign({}, state, {\n        config: Object.assign({}, {\n          'infiles': action.config.infiles,\n          'window_size': action.config.window_size,\n          'window_slide': action.config.window_slide,\n        })\n      })\n\n    default:\n      return state;\n  }\n};\n\nconst getSharedChangeCount = state => {\n  let count = 0;\n  ['similarity', 'length'].forEach(function (f) {\n    if (state.advanced[f].toString() !== initialState.advanced[f].toString()) count++;\n  });\n  return count;\n};\n\nexport default searchReducer;\n","const initialState = {\n  source: [],\n  target: [],\n};\n\nconst favoriteReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'ADD_FAVORITE':\n      return Object.assign({}, state, {\n        [action.obj.type]: [...state[action.obj.type], action.obj._id],\n      });\n    case 'REMOVE_FAVORITE':\n      return Object.assign({}, state, {\n        [action.obj.type]: state[action.obj.type].filter(m => m !== action.obj._id),\n      });\n    case 'LOAD_FAVORITES':\n      return Object.assign({}, state, action.obj);\n    default:\n      return state;\n  }\n};\n\nexport default favoriteReducer;\n","const initialState = {\n  query: '',\n  index: 0,\n  err: null,\n  field: 'title',\n  fileIds: null,\n  metadata: null,\n};\n\nconst typeaheadReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'SET_TYPEAHEAD_FIELD':\n      return Object.assign({}, state, {\n        field: action.field.toLowerCase(),\n      });\n\n    case 'SET_TYPEAHEAD_QUERY':\n      return Object.assign({}, state, {\n        query: action.query,\n      });\n\n    case 'SET_TYPEAHEAD_INDEX':\n      return Object.assign({}, state, {\n        index: action.index,\n      });\n\n    case 'RECEIVE_TYPEAHEAD_FILE_IDS':\n      return Object.assign({}, state, {\n        fileIds: action.fileIds,\n        metadata: action.metadata,\n        err: null,\n      });\n\n    case 'TYPEAHEAD_REQUEST_FAILED':\n      return Object.assign({}, state, {\n        err: true,\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport default typeaheadReducer;\n","const initialState = {\n  unit: 'passage', // 'passage', 'author', or 'book'\n  data: [], // the filtered data shown in view\n  use: 'earlier', // 'earlier' or 'later'\n  statistic: 'mean', // 'sum' or 'mean'\n  xDomain: [], // list of min, max similarity floats\n  yDomain: [], // list of min, max year ints\n  y: 'target_year', // attribute displayed on y axis\n  zoomed: false,\n  jitter: false,\n  tooltip: { title: '', author: '', x: '', y: '' },\n  err: false,\n};\n\nconst scatterplotReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'SET_UNIT':\n      return Object.assign({}, state, {\n        unit: action.unit,\n      });\n\n    case 'SET_USE':\n      return Object.assign({}, state, {\n        use: action.use,\n        y: action.use === 'earlier' ? 'target_year' : 'source_year',\n      });\n\n    case 'SET_STATISTIC':\n      return Object.assign({}, state, {\n        statistic: action.stat,\n      });\n\n    case 'SET_Y':\n      return Object.assign({}, state, {\n        y: action.y,\n      });\n\n    case 'SET_TOOLTIP':\n      return Object.assign({}, state, {\n        tooltip: action.obj,\n      });\n\n    case 'TOGGLE_JITTER':\n      return Object.assign({}, state, {\n        jitter: !state.jitter,\n      });\n\n    case 'SET_DOMAINS':\n      return Object.assign({}, state, {\n        xDomain: action.domains.x,\n        yDomains: action.domains.y,\n        zoomed: true,\n      });\n\n    case 'REMOVE_ZOOM':\n      return Object.assign({}, state, {\n        xDomain: [],\n        yDomain: [],\n        zoomed: false,\n      });\n\n    case 'SCATTERPLOT_REQUEST_FAILED':\n      return Object.assign({}, state, {\n        err: true,\n      });\n\n    case 'RECEIVE_SCATTERPLOT_RESULTS':\n      return Object.assign({}, state, {\n        data: action.obj.data,\n        xDomain: action.obj.xDomain,\n        yDomain: action.obj.yDomain,\n        zoomed: action.obj.zoomed,\n        statistic: action.obj.statistic || state.statistic,\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport default scatterplotReducer;\n","const initialState = {\n  fileId: null,\n  matches: null,\n  words: null,\n}\n\nconst reducer = (state=initialState, action) => {\n  switch (action.type) {\n    case 'SET_VIEWER_DATA':\n      return Object.assign({}, state, {\n        fileId: action.fileId,\n        matches: action.matches,\n        words: action.words,\n      })\n\n    default:\n      return state;\n  }\n}\n\nexport default reducer;","const initialState = {};\n\nconst cacheReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'ADD_RECORD_TO_CACHE':\n      const keyValuePair = {};\n      keyValuePair[action.key] = action.value;\n\n      return Object.assign({}, state, keyValuePair);\n\n    default:\n      return state;\n  }\n};\n\nexport default cacheReducer;\n","import { combineReducers } from 'redux';\nimport waffleReducer from './waffleReducer';\nimport searchReducer from './searchReducer';\nimport favoriteReducer from './favoriteReducer';\nimport typeaheadReducer from './typeaheadReducer';\nimport scatterplotReducer from './scatterplotReducer';\nimport viewerReducer from './viewerReducer';\nimport cacheReducer from './cacheReducer';\n\nexport const rootReducer = combineReducers({\n  search: searchReducer,\n  favorites: favoriteReducer,\n  typeahead: typeaheadReducer,\n  scatterplot: scatterplotReducer,\n  waffle: waffleReducer,\n  viewer: viewerReducer,\n  cache: cacheReducer,\n});\n","export const sort = arr => Object.assign([], arr).sort((a, b) => a - b);\n\nexport const toggleFavorite = obj => {\n  return (dispatch, getState) => {\n    const _id = obj.result._id;\n    const _state = getState();\n    if (_state.favorites[obj.type].indexOf(_id) > -1) {\n      dispatch(removeFavorite({ type: obj.type, _id: _id }));\n    } else {\n      dispatch(addFavorite({ type: obj.type, _id: _id }));\n    }\n    dispatch(saveFavorites());\n  };\n};\n\nexport const addFavorite = obj => ({\n  type: 'ADD_FAVORITE',\n  obj: obj,\n});\n\nexport const removeFavorite = obj => ({\n  type: 'REMOVE_FAVORITE',\n  obj: obj,\n});\n\nexport const saveFavorites = () => {\n  return (dispatch, getState) => {\n    try {\n      localStorage.setItem('favorites', JSON.stringify(getState().favorites));\n    } catch (err) {\n      console.warn(err);\n    }\n  };\n};\n\nexport const loadFavorites = () => {\n  return (dispatch, getState) => {\n    const favorites = localStorage.getItem('favorites');\n    if (favorites) {\n      dispatch({ type: 'LOAD_FAVORITES', obj: JSON.parse(favorites) });\n    }\n  };\n};\n","import fetch from 'isomorphic-fetch';\n\n/**\n * Get a JSON file, throw an exception if response status is not 200\n *\n * Returns: Promise\n * @param {string} url\n */\n\nexport const fetchJSONFile = url => {\n  const base = window.location.href.split('#')[0].replace('index.html', '');\n  url = url[0] === '/' ? url.substring(1) : url;\n  return fetch(base + url)\n    .then(response => {\n      if (response.status !== 200) {\n        throw new Error('Fetch failed (Status = ' + response.status + '): ' + url);\n      }\n      return response.json();\n    })\n    .then(obj => {\n      return obj;\n    });\n};\n","export const addCacheRecord = (key, value) => ({\n  type: 'ADD_RECORD_TO_CACHE',\n  key: key,\n  value: value,\n});\n","export const setTypeaheadField = field => ({\n  type: 'SET_TYPEAHEAD_FIELD',\n  field,\n});\n\nexport const setTypeaheadQuery = query => ({\n  type: 'SET_TYPEAHEAD_QUERY',\n  query,\n});\n\nexport const setTypeaheadIndex = index => ({\n  type: 'SET_TYPEAHEAD_INDEX',\n  index,\n});\n\nexport const typeaheadRequestFailed = () => ({\n  type: 'TYPEAHEAD_REQUEST_FAILED',\n});\n\nexport const setTypeaheadMetadata = metadata => {\n  return (dispatch) => {\n    // create a map from author/title to file ids that have that string in their metadata\n    let fileIds = {\n      author: {},\n      title: {},\n    };\n    metadata.forEach((m, fileIdx) => {\n      fileIds['author'][m.author] =\n        m.author in fileIds['author'] ? fileIds['author'][m.author].concat(fileIdx) : [fileIdx];\n      fileIds['title'][m.title] =\n        m.title in fileIds['title'] ? fileIds['title'][m.title].concat(fileIdx) : [fileIdx];\n    });\n    dispatch({\n      type: 'RECEIVE_TYPEAHEAD_FILE_IDS',\n      fileIds: fileIds,\n      metadata: metadata,\n    });\n  }\n}\n","import { history } from '../store';\nimport { fetchJSONFile } from './ajax';\nimport { addCacheRecord } from '../actions/cache';\nimport { uniq } from 'lodash';\nimport {\n  setTypeaheadQuery,\n  setTypeaheadIndex,\n  setTypeaheadField,\n  setTypeaheadMetadata,\n} from './typeahead';\n\n/**\n * Config\n **/\n\nconst fetchConfig = () => {\n  return (dispatch) => {\n    const url = `/api/config.json`;\n    return fetchJSONFile(url)\n      .then(json => {\n        dispatch({\n          type: 'SET_CONFIG',\n          config: json,\n        });\n        dispatch(setTypeaheadMetadata(json.metadata));\n      })\n      .catch(e => {\n        console.warn('Could not fetch config: ' + e);\n      });\n  }\n}\n\n/**\n * Sort\n **/\n\nconst fetchSortIndex = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    const url = `/api/indices/match-ids-by-${state.search.sortField.toLowerCase().trim()}.json`;\n    return fetchJSONFile(url)\n      .then(sortIndex => {\n        dispatch({\n          type: 'SET_SORT_ORDER_INDEX',\n          sortIndex: sortIndex,\n        });\n      })\n      .catch(e => {\n        console.warn('Could not fetch sort order: ' + e);\n      });\n  };\n};\n\nexport const setSortAndSearch = field => {\n  return dispatch => {\n    dispatch({ type: 'SET_SORT_FIELD', sortField: field });\n    dispatch(fetchSortIndex()).then(() => {\n      dispatch(fetchSearchResults());\n    });\n  };\n};\n\n/**\n * Advanced Filters\n **/\n\nexport const setAdvancedFilterField = obj => ({\n  type: 'SET_ADVANCED_FILTER',\n  ...obj,\n});\n\nexport const clearAdvancedFilterType = type => {\n  return dispatch => {\n    dispatch({\n      type: 'CLEAR_ADVANCED_FILTER_TYPE',\n      earlierLater: type,\n    });\n  };\n};\n\nexport const setLength = val => {\n  return dispatch => {\n    dispatch({\n      type: 'SET_ADVANCED_FILTER_LENGTH',\n      val: val,\n    });\n    dispatch({\n      type: 'SET_ADVANCED_FILTER_CHANGE_COUNT',\n    });\n  };\n};\n\nexport const setDisplayedLength = val => ({\n  type: 'SET_ADVANCED_FILTER_DISPLAYED_LENGTH',\n  val: val,\n});\n\nexport const setSimilarity = val => {\n  return dispatch => {\n    dispatch({\n      type: 'SET_ADVANCED_FILTER_SIMILARITY',\n      val: val,\n    });\n    dispatch({\n      type: 'SET_ADVANCED_FILTER_CHANGE_COUNT',\n    });\n  };\n};\n\nexport const setDisplayedSimilarity = val => ({\n  type: 'SET_ADVANCED_FILTER_DISPLAYED_SIMILARITY',\n  val: val,\n});\n\nexport const clearAdvancedFilters = () => {\n  return dispatch => {\n    dispatch({\n      type: 'CLEAR_ADVANCED_FILTERS',\n    });\n    dispatch(setTypeaheadQuery(''));\n    dispatch(fetchSearchResults());\n  };\n};\n\n/**\n * Search + URL interactions\n **/\n\nexport const saveSearchInUrl = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    let hash = '?';\n    hash += 'query=' + JSON.stringify(state.typeahead.query);\n    history.push(hash);\n  };\n};\n\nexport const loadSearchFromUrl = () => {\n  return (dispatch, getState) => {\n    const url = window.location.hash;\n    if (url.includes('sankey') || url.includes('works') || url.includes('viewer')) return;\n    let search = url.split('#/')[1];\n    search = search.replace('cards', '');\n    if (search.includes('?')) search = search.split('?')[1];\n    if (!search) return;\n    let obj = {};\n    search\n      .split('&')\n      .filter(arg => arg)\n      .forEach(arg => {\n        try {\n          const split = arg.split('=');\n          obj = Object.assign({}, obj, {\n            [split[0]]: JSON.parse(decodeURIComponent(split[1])),\n          });\n        } catch (e) {\n          console.warn(`Error parsing ${arg}: ${e}`);\n        }\n      });\n    // prepare the update object\n    let update = {};\n    if ('earlier' in obj) update['earlier'] = { fileId: obj.earlier };\n    if ('later' in obj) update['later'] = { fileId: obj.later };\n    dispatch({\n      type: 'LOAD_SEARCH_FROM_URL',\n      obj: update,\n    });\n    if (obj.query && obj.query.length) dispatch(setTypeaheadQuery(obj.query));\n    if (obj.field && obj.field.length) dispatch(setTypeaheadField(obj.field));\n  };\n};\n\n/**\n * Search\n **/\n\nexport const fetchSearchResults = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    dispatch(setSearchLoading(true));\n    const runSearch = () => {\n      dispatch(resetMaxDisplayedSearchResults());\n      dispatch(setTypeaheadIndex(0));\n      dispatch(scrollToCardsTop());\n      dispatch(fetchMoreSearchResults());\n    };\n    // check to see if we need to run the first search result\n    if (state.search.sortIndex && state.typeahead.metadata) {\n      runSearch();\n    } else {\n      Promise.all([\n        dispatch(fetchSortIndex()), //\n        dispatch(fetchConfig()),\n      ]).then(v => {\n        runSearch();\n      });\n    }\n  };\n};\n\n/**\n * Search Pagination\n **/\n\n// called by client to load more matches into the DOM without running a new search\nexport const displayMoreResults = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    if (state.search.maxDisplayed >= state.search.resultsMeta.totalResults) return;\n    dispatch({ type: 'DISPLAY_MORE_SEARCH_RESULTS' });\n    dispatch(fetchMoreSearchResults());\n  };\n};\n\n// load the match files for the set of displayed search results\nconst fetchMoreSearchResults = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    // get the full list of match metadata vals for the search params\n    const filteredSortIndex = getFilteredSortIndex(state);\n    // slice off a page\n    const orderedIndex = filteredSortIndex.slice(0, state.search.maxDisplayed);\n    // get the unique match file ids for which we need to extract matches\n    const matchFileIDs = uniq(orderedIndex.map(d => d[1]));\n    // get the match file contents\n    dispatch(getMatchFiles(matchFileIDs))\n      .then(matchFiles => {\n        const matches = orderedIndex.reduce((arr, i) => {\n          const [matchIndex, matchFileId] = i;\n          arr.push(matchFiles[matchFileIDs.indexOf(matchFileId)][matchIndex]);\n          return arr;\n        }, []);\n        return {\n          count: filteredSortIndex.length,\n          docs: matches,\n        };\n      })\n      .then(({ count, docs }) => {\n        dispatch({\n          type: 'SET_ALL_SEARCH_RESULTS',\n          docs: docs,\n          total: count,\n          err: false,\n        });\n      })\n      .catch(err => {\n        dispatch({\n          type: 'SET_ALL_SEARCH_RESULTS',\n          docs: [],\n          err: err,\n        });\n      });\n  };\n};\n\nconst resetMaxDisplayedSearchResults = () => ({\n  type: 'RESET_MAX_DISPLAYED_SEARCH_RESULTS',\n});\n\nconst scrollToCardsTop = () => {\n  return () => {\n    const elem = document.querySelector('#result-pairs-container');\n    if (!elem) return;\n    elem.scrollTo(0, 0);\n  };\n};\n\n/**\n * Main search function that filters the sorted match index to find suitable matches\n */\n\nconst getFilteredSortIndex = state => {\n  const { sortIndex, advanced } = { ...state.search };\n  const { fileIds, field, query } = { ...state.typeahead };\n\n  // handle case where Results.jsx runs first search instead of '../store.js'\n  if (!fileIds) return;\n\n  // given a query and a map from strings to lists of values, return values that match the query\n  const getValuesOfMatchingKeys = (q, map) => {\n    let s = new Set();\n    // filter the keys of the map\n    Object.keys(map).map(k => {\n      // if there's no query add all values for this key\n      if (!q || !q.length) {\n        map[k].map(v => s.add(v));\n      } else {\n        // check if this key (string) matches the query\n        if (k.trim().toLowerCase().includes(q.trim().toLowerCase())) {\n          // add all the values assigned to this matching key\n          map[k].map(v => s.add(v));\n        }\n      }\n      return null;\n    });\n    return s;\n  };\n\n  const getEarlierOrLaterFileIds = (field, map) => {\n    return Number.isInteger(advanced[field].fileId)\n      ? new Set([advanced[field].fileId])\n      : getSetIntersection([\n          getValuesOfMatchingKeys(advanced[field].title, map.title),\n          getValuesOfMatchingKeys(advanced[field].author, map.author),\n        ]);\n  };\n\n  // given a list of sets, return a set with the intersection of all sets\n  const getSetIntersection = sets => {\n    return new Set(sets.reduce((a, b) => [...a].filter(c => b.has(c))));\n  };\n\n  /**\n   * Get the file ids that are valid for the earlier, later, or either column\n   **/\n\n  const filterFileIds = {\n    either: getValuesOfMatchingKeys(query, fileIds[field]), // from typeahead\n    earlier: getEarlierOrLaterFileIds('earlier', fileIds), // from filters\n    later: getEarlierOrLaterFileIds('later', fileIds), // from filters\n  };\n  // return the filtered sort index\n  return sortIndex.filter(item => {\n    // destructure a single row from the sorted match index\n    const row = parseSortIndexRow(item);\n    if (row.similarity < advanced.similarity[0] || row.similarity > advanced.similarity[1])\n      return false;\n    if (row.length < advanced.length[0] || row.length > advanced.length[1]) return false;\n    if (!filterFileIds.earlier.has(row.earlierId)) return false;\n    if (!filterFileIds.later.has(row.laterId)) return false;\n    if (!filterFileIds.either.has(row.earlierId) && !filterFileIds.either.has(row.laterId))\n      return false;\n    return true;\n  });\n};\n\nexport const parseSortIndexRow = arr => {\n  return {\n    id: arr[0],\n    earlierId: arr[1],\n    laterId: arr[2],\n    length: arr[3],\n    probability: arr[4],\n    similarity: arr[5],\n  };\n};\n\n/**\n * Match file loading\n **/\n\nconst getMatchFiles = matchFileIDs => {\n  return (dispatch, getState) => {\n    return Promise.all(matchFileIDs.map(matchFileID => dispatch(getMatchFile(matchFileID))));\n  };\n};\n\n// Helper to fetch match file from memory or network\nexport const getWordsFile = matchFileID => {\n  return (dispatch, getState) => {\n    const state = getState();\n    const cacheKey = `words/${matchFileID}.json`;\n    return cacheKey in state.cache\n      ? new Promise((resolve, reject) => resolve(state.cache[cacheKey]))\n      : fetchWordsFile(matchFileID.toString()).then(words => {\n          dispatch(addCacheRecord(cacheKey, words));\n          return words;\n        });\n  };\n};\n\n// Helper to fetch match file from memory or network\nexport const getMatchFile = matchFileID => {\n  return (dispatch, getState) => {\n    const state = getState();\n    const cacheKey = `matches/${matchFileID}.json`;\n    return cacheKey in state.cache\n      ? new Promise((resolve, reject) => resolve(state.cache[cacheKey]))\n      : fetchMatchFile(matchFileID).then(match => {\n          dispatch(addCacheRecord(cacheKey, match));\n          return match;\n        });\n  };\n};\n\nconst fetchWordsFile = textID => {\n  return fetchJSONFile('/api/texts/' + textID.toString() + '.json');\n}\n\nexport const fetchMatchFile = textID => {\n  return fetchJSONFile('/api/matches/' + textID.toString() + '.json');\n};\n\n/**\n * Search loading\n **/\n\nexport const setSearchLoading = bool => ({\n  type: 'SET_SEARCH_LOADING',\n  bool: bool,\n});\n","import { createStore, applyMiddleware } from 'redux';\nimport { routerMiddleware, connectRouter } from 'connected-react-router';\nimport { createHashHistory } from 'history';\nimport { createLogger } from 'redux-logger';\nimport thunkMiddleware from 'redux-thunk';\nimport { rootReducer } from './reducers/index';\nimport { loadFavorites } from './actions/favorite';\nimport { fetchSearchResults } from './actions/search';\nimport freeze from 'redux-freeze';\n\nconst history = createHashHistory();\nconst loggerMiddleware = createLogger();\n\nlet middlewares = [thunkMiddleware, routerMiddleware(history)];\n\n// add the freeze dev middleware\nif (process.env.NODE_ENV !== 'production') {\n  middlewares.push(freeze);\n  middlewares.push(loggerMiddleware);\n}\n\n// apply the middleware\nlet middleware = applyMiddleware(...middlewares);\n\n// create the store\nconst store = createStore(connectRouter(history)(rootReducer), middleware);\n\n// load the favorites saved in clientside storage\nstore.dispatch(loadFavorites());\n\n// load the initial search results\nstore.dispatch(fetchSearchResults());\n\nexport { store, history };\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport brand from '../../assets/images/intertext.png';\n\nconst routes = [\n  {\n    route: '/cards',\n    label: 'Cards',\n  },\n  {\n    route: '/sankey',\n    label: 'Sankey',\n  },\n  {\n    route: '/works',\n    label: 'Works',\n  },\n];\n\nconst Header = props => {\n  return (\n    <header>\n      <div className='header-text row align-center space-between'>\n        <Link className='brand' to='/'>\n          <img src={brand} alt='Intertext brand logo' />\n        </Link>\n        <nav className='row align-center'>\n          {routes.map(r => (\n            <Link key={r.route} to={r.route} className={props.route === r.route ? 'active' : ''}>\n              {r.label}\n            </Link>\n          ))}\n        </nav>\n        {/* Equal width as the brand text to center the links */}\n        <div style={{ width: '132px' }} />\n      </div>\n    </header>\n  );\n};\n\nconst mapStateToProps = state => ({\n  route: state.router.location.pathname,\n});\n\nexport default connect(mapStateToProps)(Header);\n","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/yale-mark.59f2ddfb.svg\";","import React from 'react';\nimport mark from '../../assets/images/yale-mark.svg';\n\nclass Footer extends React.Component {\n  render() {\n    return (\n      <footer className='row space-between align-center'>\n        <a className='row align-center' href='https://dhlab.yale.edu'>\n          <img className='yale-mark' src={mark} alt='Yale University Watermark' />\n        </a>\n        <div className='experiment'>An experiment of the Yale DHLab</div>\n      </footer>\n    );\n  }\n}\n\nexport default Footer;\n","import React from 'react';\nimport Header from './partials/Header';\nimport Footer from './partials/Footer';\n\nexport default class AppWrapper extends React.Component {\n  render() {\n    return (\n      <div className='app-container col'>\n        <Header />\n        <div className='page-container flex-1'>{this.props.children}</div>\n        <Footer />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport { setSortAndSearch } from '../../actions/search';\n\nclass SortResults extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(e) {\n    this.props.setSortAndSearch(e.target.value);\n  }\n\n  render() {\n    return (\n      <select className='sort-results' value={this.props.sortField} onChange={this.handleChange}>\n        <option disabled>Sort By</option>\n        <option value='length'>Length</option>\n        <option value='similarity'>Similarity</option>\n        <option value='probability'>Probability</option>\n        <option value='author'>Author</option>\n        <option value='title'>Title</option>\n        <option value='year'>Date</option>\n      </select>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  sortField: state.search.sortField,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setSortAndSearch: field => dispatch(setSortAndSearch(field)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SortResults);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nconst ResultCount = props => (\n  <div className='results-count'>\n    {props.loading ? null : (\n      <>\n        <span>{props.totalResults || 0}</span>\n        <span>matches</span>\n      </>\n    )}\n  </div>\n);\n\nResultCount.propTypes = {\n  totalResults: PropTypes.number,\n};\n\nconst mapStateToProps = state => ({\n  loading: state.search.loading,\n  totalResults: state.search.resultsMeta.totalResults,\n});\n\nexport default connect(mapStateToProps)(ResultCount);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { fetchSearchResults } from '../../actions/search';\nimport { setTypeaheadQuery } from '../../actions/typeahead';\n\nclass TypeaheadResults extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleMousedown = this.handleMousedown.bind(this);\n    this.handleMouseup = this.handleMouseup.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousedown', this.handleMousedown, false);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousedown', this.handleMousedown, false);\n  }\n\n  handleMousedown(e) {\n    // stop blur of input; event order: mousedown, blur, mouseup\n    if (e.target.className === 'typeahead-result') {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  handleMouseup(e) {\n    if (!e.target.className.includes('typeahead-result')) return;\n    this.props.setTypeaheadQuery(e.target.getAttribute('data-value'));\n    this.props.fetchSearchResults();\n    document.querySelector('.typeahead input').blur();\n  }\n\n  render() {\n    const className = this.props.results.length > 0 ? '' : 'hidden';\n    return (\n      <span className={'typeahead-results ' + className}>\n        {this.props.query.length > 0 ? (\n          <span\n            className={\n              this.props.index === 0\n                ? 'typeahead-result search-icon active'\n                : 'typeahead-result search-icon'\n            }\n          >\n            {this.props.query}\n          </span>\n        ) : (\n          <span />\n        )}\n        {this.props.results.map((result, idx) => {\n          return (\n            <Result\n              key={idx}\n              val={result}\n              onClick={this.handleMouseup}\n              active={idx + 1 === this.props.index}\n              submitSearch={this.props.submitSearch}\n            />\n          );\n        })}\n      </span>\n    );\n  }\n}\n\nTypeaheadResults.propTypes = {\n  fetchSearchResults: PropTypes.func.isRequired,\n  index: PropTypes.number.isRequired,\n  query: PropTypes.string.isRequired,\n  setTypeaheadQuery: PropTypes.func.isRequired,\n  submitSearch: PropTypes.func.isRequired,\n};\n\nconst Result = props => (\n  <span\n    onClick={props.onClick}\n    className={props.active ? 'typeahead-result active' : 'typeahead-result'}\n    data-value={props.val}\n  >\n    {props.val}\n  </span>\n);\n\nResult.propTypes = {\n  active: PropTypes.bool,\n  onClick: PropTypes.func.isRequired,\n  submitSearch: PropTypes.func.isRequired,\n  val: PropTypes.string.isRequired,\n};\n\nconst mapStateToProps = state => ({\n  results: state.typeahead.fileIds\n    ? Object.keys(state.typeahead.fileIds[state.typeahead.field])\n    : [],\n  query: state.typeahead.query,\n  index: state.typeahead.index,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setTypeaheadQuery: val => dispatch(setTypeaheadQuery(val)),\n  fetchSearchResults: () => dispatch(fetchSearchResults()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TypeaheadResults);\n","import React, { useRef } from 'react';\nimport Results from './TypeaheadResults';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { fetchSearchResults } from '../../actions/search';\nimport { setTypeaheadQuery, setTypeaheadIndex } from '../../actions/typeahead';\n\nconst Typeahead = props => {\n  const ref = useRef();\n\n  const handleKeyUp = e => {\n    var index = props.index;\n    // up arrow\n    if (e.keyCode === 38) {\n      if (index - 1 >= 0) {\n        props.setTypeaheadIndex(index - 1);\n      }\n      // down arrow\n    } else if (e.keyCode === 40) {\n      if (index + 1 <= props.results.length) {\n        props.setTypeaheadIndex(index + 1);\n      }\n      // enter key\n    } else if (e.keyCode === 13) {\n      submitSearch();\n    }\n  };\n\n  const handleChange = e => {\n    if (e.keyCode === 38 || e.keyCode === 40 || e.keyCode === 13) return;\n    props.setTypeaheadQuery(e.target.value);\n    props.setTypeaheadIndex(0);\n  };\n\n  const submitSearch = () => {\n    // identify the search phrase requested by the user\n    const phrase = props.index === 0 ? props.query : props.results[props.index - 1];\n    props.setTypeaheadQuery(phrase);\n    // submit the search and remove focus from the input\n    props.fetchSearchResults();\n    ref.current.blur();\n  };\n\n  return (\n    <div className='typeahead'>\n      <div className='search-button' />\n      <input ref={ref} value={props.query} onKeyUp={handleKeyUp} onChange={handleChange} />\n      <Results submitSearch={submitSearch} />\n    </div>\n  );\n};\n\nTypeahead.propTypes = {\n  fetchSearchResults: PropTypes.func.isRequired,\n  index: PropTypes.number.isRequired,\n  query: PropTypes.string.isRequired,\n  setTypeaheadIndex: PropTypes.func.isRequired,\n  setTypeaheadQuery: PropTypes.func.isRequired,\n};\n\nconst mapStateToProps = state => ({\n  index: state.typeahead.index,\n  results: state.typeahead.results,\n  query: state.typeahead.query,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setTypeaheadQuery: val => dispatch(setTypeaheadQuery(val)),\n  setTypeaheadIndex: val => dispatch(setTypeaheadIndex(val)),\n  fetchSearchResults: () => dispatch(fetchSearchResults()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Typeahead);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { setTypeaheadField } from '../../actions/typeahead';\n\nclass TypeaheadSelect extends React.Component {\n  render() {\n    return (\n      <div className='typeahead-select-container'>\n        <select\n          className='custom-select'\n          onChange={this.props.setTypeaheadField}\n          value={this.props.field}\n        >\n          <option disabled>Search By</option>\n          <option value='author'>Author</option>\n          <option value='title'>Title</option>\n        </select>\n      </div>\n    );\n  }\n}\n\nTypeaheadSelect.propTypes = {\n  field: PropTypes.string.isRequired,\n  setTypeaheadField: PropTypes.func.isRequired,\n};\n\nconst mapStateToProps = state => ({\n  field: state.typeahead.field,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setTypeaheadField: event => dispatch(setTypeaheadField(event.target.value)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TypeaheadSelect);\n","export default __webpack_public_path__ + \"static/media/filter-icon.a96b9720.svg\";","import React, { useState, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport * as searchActions from '../../actions/search';\nimport Slider from 'rc-slider';\n\nconst Range = Slider.createSliderWithTooltip(Slider.Range);\n\nclass AdvancedFilters extends React.Component {\n  constructor(props) {\n    super(props);\n    this.setLength = this.setLength.bind(this);\n    this.setDisplayedLength = this.setDisplayedLength.bind(this);\n    this.setSimilarity = this.setSimilarity.bind(this);\n    this.setDisplayedSimilarity = this.setDisplayedSimilarity.bind(this);\n    this.clearAdvanced = this.clearAdvanced.bind(this);\n  }\n\n  setDisplayedLength(val) {\n    this.props.setDisplayedLength(val);\n  }\n\n  setLength(val) {\n    this.props.setLength(val);\n    this.props.search();\n  }\n\n  setDisplayedSimilarity(val) {\n    this.props.setDisplayedSimilarity(val);\n  }\n\n  setSimilarity(val) {\n    this.props.setSimilarity(val);\n    this.props.search();\n  }\n\n  clearAdvanced() {\n    clearInputs(document.querySelector('#advanced-filter-columns'));\n    this.props.clearAdvanced();\n  }\n\n  render() {\n    const { open, selectionCount, refProp, displayedLength, displayedSimilarity } = {\n      ...this.props,\n    };\n    let className = 'col space-between ';\n    if (open) className += 'open ';\n    if (selectionCount > 0) className += 'changed ';\n    return (\n      <div id='advanced-filters' className={className} ref={refProp}>\n        <div id='clear-advanced-filter' onClick={this.clearAdvanced}>\n          Clear \n        </div>\n        <div id='shared-advanced-filters'>\n          <div className='shared-advanced-filter row align-center'>\n            <div className='label'>Match Length</div>\n            <Range\n              min={1}\n              max={25}\n              step={1}\n              value={displayedLength}\n              onChange={val => this.setDisplayedLength(val)}\n              onAfterChange={val => this.setLength(val)}\n            />\n          </div>\n          <div className='shared-advanced-filter row align-center'>\n            <div className='label'>Similarity</div>\n            <Range\n              min={1}\n              max={100}\n              step={1}\n              value={displayedSimilarity}\n              onChange={val => this.setDisplayedSimilarity(val)}\n              onAfterChange={val => this.setSimilarity(val)}\n            />\n          </div>\n        </div>\n        <div id='advanced-filter-columns' className='row'>\n          <AdvancedFilterColumn earlierLater='earlier' {...this.props} />\n          <AdvancedFilterColumn earlierLater='later' {...this.props} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst AdvancedFilterColumn = props => {\n  const ref = useRef();\n  const [dirty, setDirty] = useState(false);\n\n  const setField = (earlierLater, field, val) => {\n    setDirty(true);\n    props.setField({\n      earlierLater: earlierLater,\n      field: field,\n      value: val,\n    });\n  };\n\n  const clearColumn = () => {\n    clearInputs(ref.current);\n    props.clearColumn(props.earlierLater);\n  };\n\n  const search = () => {\n    setDirty(false);\n    props.search();\n  };\n\n  let buttonClass = 'advanced-filter-apply-button';\n  buttonClass += dirty ? ' active' : ' disabled';\n\n  const fields = [\n    {\n      label: 'Author',\n      field: 'author',\n      type: 'text',\n    },\n    {\n      label: 'Title',\n      field: 'title',\n      type: 'text',\n    },\n    {\n      label: 'File Id',\n      field: 'fileId',\n      type: 'number',\n    },\n  ];\n\n  return (\n    <div className='advanced-filter-column flex-1' ref={ref}>\n      <div className='advanced-filter-column-label'>{titleCase(props.earlierLater)} Text</div>\n      {fields.map(f => {\n        return (\n          <div key={f.field} className='row justify-start align-center'>\n            <div className='label'>{f.label}</div>\n            {f.type === 'text' || f.type === 'number' ? (\n              <AdvancedFilterInput\n                type={f.type}\n                field={f.field}\n                earlierLater={props.earlierLater}\n                defaultValue={props.advanced[props.earlierLater][f.field]}\n                onChange={setField}\n              />\n            ) : null}\n          </div>\n        );\n      })}\n      <div className='advanced-filter-footer justify-end row align-center'>\n        <div\n          className={\n            props.advanced[props.earlierLater].changed > 0\n              ? 'advanced-filter-clear clearable'\n              : 'advanced-filter-clear disabled'\n          }\n          onClick={clearColumn}\n        >\n          Clear\n        </div>\n        <button className={buttonClass} onClick={search}>\n          Apply\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst AdvancedFilterInput = props => {\n  return (\n    <input\n      defaultValue={props.defaultValue}\n      onChange={e => props.onChange(props.earlierLater, props.field, e.target.value)}\n      type={props.type}\n    />\n  );\n};\n\nconst clearInputs = elem => {\n  const elems = elem.querySelectorAll('input');\n  elems.forEach(e => (e.value = ''));\n};\n\nconst titleCase = s => {\n  return s.substring(0, 1).toUpperCase() + s.substring(1, s.length).toLowerCase();\n};\n\nconst mapStateToProps = state => ({\n  advanced: state.search.advanced,\n  length: state.search.advanced.length,\n  displayedLength: state.search.advanced.displayedLength,\n  similarity: state.search.advanced.similarity,\n  displayedSimilarity: state.search.advanced.displayedSimilarity,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setField: obj => dispatch(searchActions.setAdvancedFilterField(obj)),\n  setLength: val => dispatch(searchActions.setLength(val)),\n  setDisplayedLength: val => dispatch(searchActions.setDisplayedLength(val)),\n  setSimilarity: val => dispatch(searchActions.setSimilarity(val)),\n  setDisplayedSimilarity: val => dispatch(searchActions.setDisplayedSimilarity(val)),\n  clearColumn: type => dispatch(searchActions.clearAdvancedFilterType(type)),\n  search: () => dispatch(searchActions.fetchSearchResults()),\n  clearAdvanced: () => dispatch(searchActions.clearAdvancedFilters()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AdvancedFilters);\n","import React, { useState, useEffect, useRef } from 'react';\nimport SortResults from './SortResults';\nimport ResultCount from '../cards/ResultCount';\nimport Typeahead from '../typeahead/Typeahead';\nimport TypeaheadSelect from '../typeahead/TypeaheadSelect';\nimport filterIcon from '../../assets/images/icons/filter-icon.svg';\nimport AdvancedFilters from './AdvancedFilters';\nimport { connect } from 'react-redux';\n\nconst Filters = props => {\n  const ref = useRef();\n  const childRef = useRef();\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    const onWindowClick = e => {\n      const elem = e.target;\n      if (!childRef.current || childRef.current.contains(elem)) return;\n      if (!ref.current || ref.current.contains(elem)) return;\n      setOpen(false);\n    };\n    window.addEventListener('mousedown', onWindowClick);\n    return () => {\n      window.removeEventListener('mousedown', onWindowClick);\n    };\n  }, [open]);\n\n  const toggleOpen = () => {\n    setOpen(!open);\n  };\n\n  let iconClassName = '';\n  if (open) iconClassName += 'open ';\n  if (props.selectionCount > 0) iconClassName += 'has-selection ';\n  return (\n    <div id='filters-container' className='col justify-center' ref={ref}>\n      <div id='filters-inner' className='row space-between justify-center align-center'>\n        <div className='filter-group row justify-start align-center'>\n          <span className='typeahead-select-label'>Search all passages by</span>\n          <TypeaheadSelect />\n        </div>\n        <Typeahead />\n        <div className='filter-group row justify-end align-center'>\n          <ResultCount />\n          <SortResults />\n          <img\n            alt='Advanced filters icon'\n            className={iconClassName}\n            id='advanced-filters-icon'\n            src={filterIcon}\n            onClick={toggleOpen}\n          />\n          {props.selectionCount > 0 ? (\n            <div id='advanced-filters-selection-count' className='row justify-center align-center'>\n              <div>{props.selectionCount}</div>\n            </div>\n          ) : null}\n        </div>\n      </div>\n      <AdvancedFilters refProp={childRef} open={open} selectionCount={props.selectionCount} />\n    </div>\n  );\n};\n\nconst getFilterSelectionCount = advanced => {\n  return advanced.changed + advanced.earlier.changed + advanced.later.changed;\n};\n\nconst mapStateToProps = state => ({\n  selectionCount: getFilterSelectionCount(state.search.advanced),\n});\n\nconst mapDispatchToProps = dispatch => ({});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Filters);\n","import { history } from '../store';\nimport { fetchMatchFile } from './search';\n\nexport const setWaffleVisualized = obj => ({\n  type: 'SET_WAFFLE_VISUALIZED',\n  obj: obj,\n});\n\nexport const setWaffleData = obj => ({\n  type: 'SET_WAFFLE_DATA',\n  obj: obj,\n});\n\nexport const setActiveWaffle = obj => ({\n  type: 'SET_WAFFLE_ACTIVE',\n  obj: obj,\n});\n\nexport const waffleImageRequestFailed = () => ({\n  type: 'WAFFLE_IMAGE_REQUEST_FAILED',\n});\n\nexport const receiveWaffleImage = url => ({\n  type: 'RECEIVE_WAFFLE_IMAGE',\n  url: url,\n});\n\nexport const setWaffleFeature = feature => {\n  return dispatch => {\n    dispatch({ type: 'SET_WAFFLE_FEATURE', feature: feature });\n    dispatch(plotWaffle());\n  };\n};\n\nexport const getWaffleActive = (d, i) => {\n  return dispatch => {\n    dispatch(requestWaffleActiveData(d, i));\n  };\n};\n\nexport const visualize = obj => {\n  return (dispatch, getState) => {\n    dispatch(setWaffleVisualized(obj));\n    dispatch(plotWaffle());\n    dispatch(saveWaffleInUrl());\n  };\n};\n\nexport const saveWaffleInUrl = () => {\n  // TODO: Store waffle state in url params\n  return dispatch => {\n    history.push('/waffle');\n  };\n};\n\nexport const requestWaffleActiveData = d => {\n  return (dispatch, getState) => {\n    const result = getState().waffle.matches.filter(r => r._id === d._id)[0];\n    dispatch(setActiveWaffle(Object.assign({}, result)));\n  };\n};\n\nexport const plotWaffle = () => {\n  return (dispatch, getState) => {\n    const state = getState();\n    const size = 10; // h, w of each waffle cell\n    const levelMargin = 10; // margin between levels\n    const margin = { top: 0, right: 80, bottom: 90, left: 0 };\n    getCellData(state.waffle.file_id, state.waffle.feature).then(data => {\n      const cols = data.cols;\n      // find the level with the max column count\n      const maxCol = keys(cols).reduce((a, b) => (cols[a] > cols[b] ? a : b));\n      // find all unique levels for an ordinal x domain\n      const xDomain = keys(cols);\n      // find the chart width\n      let width = xDomain.length * (cols[maxCol] * size + levelMargin);\n      width += margin.right + margin.left;\n      dispatch(\n        setWaffleData({\n          matches: data.matches,\n          data: data.cells,\n          xDomain: xDomain,\n          feature: state.waffle.feature,\n          width: width,\n          columnCounts: cols,\n          maxColumn: cols[maxCol],\n          levelMargin: levelMargin,\n        })\n      );\n    });\n  };\n};\n\nconst getCellData = async (fileId, feature) => {\n  const rows = 10; // waffles per col\n  let counts = {},\n    cols = {},\n    data = [];\n  // fetch all matches for the requested query file\n  return fetchMatchFile(fileId).then(matches => {\n    matches.map((d, i) => {\n      // get the portion of this match that isn't from the visualized fileId\n      let level = d.source_file_id === fileId ? d['target_' + feature] : d['source_' + feature];\n      // set the 0-based count of the times each level occurs\n      counts[level] = counts[level] > -1 ? counts[level] + 1 : 0;\n      // set the 0-based column index where this cell belongs\n      let col = Math.floor(counts[level] / rows);\n      // set the 0-based row index where this cell belongs\n      let row = counts[level] % rows;\n      // set the 1-based count of columns for this level\n      cols[level] = cols[level] ? Math.max(cols[level], col + 1) : 1;\n      // add this observation to the outgoing data\n      data.push({\n        row: row,\n        column: col,\n        xLevel: level.toString(),\n        similarity: d.similarity,\n        _id: d._id,\n      });\n      return null;\n    });\n    return {\n      cells: data,\n      cols: cols,\n      matches: matches,\n    };\n  });\n};\n\nconst keys = obj => Object.keys(obj);\n","import React from 'react';\n\nexport default class ReadIcon extends React.Component {\n  render() {\n    return (\n      <svg\n        className='result-footer-icon read-icon'\n        xmlns='http://www.w3.org/2000/svg'\n        viewBox='-1378.033 1832 15.753 15.85'\n      >\n        <path\n          d='M15.587,13.5l-2.8-2.8a5.868,5.868,0,0,0,1.2-3.7A6.954,6.954,0,0,0,6.994,0,6.954,6.954,0,0,0,0,7a6.954,6.954,0,0,0,6.994,7,7.032,7.032,0,0,0,3.8-1.1l2.8,2.8a.483.483,0,0,0,.7,0l1.4-1.4A.755.755,0,0,0,15.587,13.5ZM6.994,12A4.949,4.949,0,0,1,2,7a4.949,4.949,0,0,1,5-5,4.949,4.949,0,0,1,5,5A4.949,4.949,0,0,1,6.994,12Z'\n          transform='translate(-1378.033 1832)'\n        />\n      </svg>\n    );\n  }\n}\n","import React from 'react';\n\nexport default class FavoriteIcon extends React.Component {\n  render() {\n    return (\n      <svg\n        className='result-footer-icon favorite-icon'\n        xmlns='http://www.w3.org/2000/svg'\n        viewBox='-1093.271 1833 14.088 14'\n      >\n        <path\n          d='M10.991,0h-.6a3.721,3.721,0,0,0-3.3,1.763A3.976,3.976,0,0,0,3.8,0H3.2C1.8.207.2,1.452,0,4.044v.83C.2,7.259,1.9,10.267,7.094,14c5.1-3.733,6.894-6.741,6.994-9.126v-.83C13.888,1.452,12.29.207,10.991,0Z'\n          transform='translate(-1093.271 1833)'\n        />\n      </svg>\n    );\n  }\n}\n","import React from 'react';\n\nexport default class VisualizeIcon extends React.Component {\n  render() {\n    return (\n      <svg xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' viewBox='0 0 17.5 17.5'>\n        <rect x='0.8' y='8.8' width='8' height='8' />\n        <rect x='8.8' y='8.8' width='8' height='8' />\n        <rect x='8.8' y='0.8' width='8' height='8' />\n      </svg>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { toggleFavorite } from '../../actions/favorite';\nimport { visualize } from '../../actions/waffle';\nimport ReadIcon from './icons/ReadIcon';\nimport FavoriteIcon from './icons/FavoriteIcon';\nimport VisualizeIcon from './icons/VisualizeIcon';\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n    this.getText = this.getText.bind(this);\n    this.favorite = this.favorite.bind(this);\n    this.visualize = this.visualize.bind(this);\n    this.getFavoriteClass = this.getFavoriteClass.bind(this);\n  }\n\n  getText(field, prefix) {\n    const text = this.props.result[this.props.type + '_' + field];\n    prefix = prefix || '';\n    return { __html: prefix + text };\n  }\n\n  favorite() {\n    this.props.toggleFavorite({\n      type: this.props.type,\n      result: this.props.result,\n    });\n  }\n\n  visualize() {\n    this.props.visualize(\n      Object.assign({}, this.props.result, {\n        type: this.props.type,\n      })\n    );\n  }\n\n  getFavoriteClass() {\n    const _id = this.props.result._id;\n    const favs = this.props.favorites[this.props.type];\n    return favs.indexOf(_id) > -1 ? 'favorite active' : 'favorite';\n  }\n\n  render() {\n    const author = this.getText('author');\n    return (\n      <div className={`result col space-between flex-1`}>\n        <div className='result-top row space-between align-center'>\n          {this.props.type === 'source' || this.props.headerRight\n            ? <HeaderLeft getText={this.getText} />\n            : <HeaderRight getText={this.getText} />\n          }\n        </div>\n        <div className='result-body flex-1'>\n          {author && author.__html != 'Unknown'\n          ? <div className='result-author' dangerouslySetInnerHTML={author} />\n          : null}\n          <div className='result-match'>\n            <span className='prematch' dangerouslySetInnerHTML={this.getText('prematch')} />\n            <span className='match' dangerouslySetInnerHTML={this.getText('match', ' ')} />\n            <span className='postmatch' dangerouslySetInnerHTML={this.getText('postmatch', ' ')} />\n          </div>\n        </div>\n        <div className='result-footer-container'>\n          <div className='result-footer row'>\n            {this.props.result[this.props.type + '_url'] ? (\n              <>\n                <a\n                  className='read'\n                  target='_blank'\n                  href={this.props.result[this.props.type + '_url']}\n                  rel='noreferrer'\n                >\n                  <ReadIcon />\n                  Read\n                </a>\n              </>\n            ) : null}\n            <div onClick={this.favorite} className={this.getFavoriteClass()}>\n              <FavoriteIcon />\n              Favorite\n            </div>\n            <Link to={'waffle'} onClick={this.visualize} className='visualize'>\n              <VisualizeIcon />\n              Visualize\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst HeaderLeft = props => {\n  return (\n    <>\n      <div className='result-title' dangerouslySetInnerHTML={props.getText('title')} />\n      {props.getText('year') ? (\n        <div className='result-year-container header-left'>\n          <div className='result-year' dangerouslySetInnerHTML={props.getText('year')} />\n        </div>\n      ) : null}\n    </>\n  )\n}\n\nconst HeaderRight = props => {\n  return (\n    <>\n      <div className='result-year-container header-right'>\n        <div className='result-year' dangerouslySetInnerHTML={props.getText('year')} />\n      </div>\n      <div className='result-title' dangerouslySetInnerHTML={props.getText('title')} />\n    </>\n  )\n}\n\nexport const CardProps = PropTypes.shape({\n  _id: PropTypes.number,\n  similarity: PropTypes.number.isRequired,\n  source_author: PropTypes.string.isRequired,\n  source_file_id: PropTypes.number.isRequired,\n  source_filename: PropTypes.string.isRequired,\n  source_match: PropTypes.string.isRequired,\n  source_postmatch: PropTypes.string.isRequired,\n  source_prematch: PropTypes.string.isRequired,\n  source_segment_ids: PropTypes.arrayOf(PropTypes.number.isRequired),\n  source_title: PropTypes.string.isRequired,\n  source_url: PropTypes.string,\n  source_year: PropTypes.string.isRequired,\n  target_author: PropTypes.string.isRequired,\n  target_file_id: PropTypes.number.isRequired,\n  target_file_path: PropTypes.string.isRequired,\n  target_filename: PropTypes.string.isRequired,\n  target_match: PropTypes.string.isRequired,\n  target_postmatch: PropTypes.string.isRequired,\n  target_prematch: PropTypes.string.isRequired,\n  target_segment_ids: PropTypes.arrayOf(PropTypes.number.isRequired),\n  target_title: PropTypes.string.isRequired,\n  target_url: PropTypes.string,\n  target_year: PropTypes.string.isRequired,\n});\n\nCard.propTypes = {\n  compare: PropTypes.shape({\n    file_id: PropTypes.number,\n    segment_ids: PropTypes.string,\n    type: PropTypes.string,\n  }),\n  favorites: PropTypes.shape({\n    source: PropTypes.arrayOf(PropTypes.number),\n    target: PropTypes.arrayOf(PropTypes.number),\n  }),\n  result: CardProps,\n  toggleFavorite: PropTypes.func.isRequired,\n  type: PropTypes.string.isRequired,\n  visualize: PropTypes.func.isRequired,\n};\n\nconst mapStateToProps = state => ({\n  favorites: state.favorites,\n  compare: state.compare,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  toggleFavorite: obj => dispatch(toggleFavorite(obj)),\n  visualize: obj => dispatch(visualize(obj)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Card);\n","import React from 'react';\n\nconst Loader = props => <div className='loader'></div>;\n\nexport default Loader;\n","import React, { useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport Filters from '../filters/Filters';\nimport Card, { CardProps } from './Card';\nimport Loader from '../partials/Loader';\nimport { displayMoreResults } from '../../actions/search';\nimport { throttle } from 'lodash';\n\nconst Cards = props => {\n  const { results, loading, displayMoreResults } = {\n    ...props,\n  };\n\n  const ref = useRef();\n\n  useEffect(() => {\n    const elem = ref.current;\n    if (!elem) return;\n    const onScroll = throttle(() => {\n      if (elem.scrollTop / elem.clientHeight > 0.75) displayMoreResults();\n    }, 500);\n    ref.current.addEventListener('scroll', onScroll);\n    return () => {\n      if (elem) elem.removeEventListener('scroll', onScroll);\n    };\n  }, [displayMoreResults]);\n\n  return (\n    <div id='results-container' className='col align-center'>\n      <Filters />\n      <div\n        id='result-pairs-container'\n        ref={ref}\n        className={loading ? 'flex-1 col justify-center' : 'flex-1 col'}\n      >\n        {loading ? (\n          <Loader />\n        ) : results && results.length ? (\n          <CardPairs results={results} />\n        ) : (\n          <span className='no-results'>Sorry, no results could be found</span>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst CardPairs = props => {\n  return (\n    <div>\n      {props.results.map((result, idx) => (\n        <div className='result-pair row' key={idx}>\n          <Card result={result} type='source' />\n          <div className='similarity-circle row justify-center align-center'>\n            <div className='similarity row justify-center align-center'>\n              <span>{Math.round(result.similarity) + '%'}</span>\n            </div>\n          </div>\n          <Card result={result} type='target' />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nCards.propTypes = {\n  history: PropTypes.shape({\n    push: PropTypes.func.isRequired,\n  }),\n  location: PropTypes.object,\n  match: PropTypes.object,\n  results: PropTypes.arrayOf(CardProps),\n};\n\nconst mapStateToProps = state => ({\n  results: state.search.results,\n  loading: state.search.resultsMeta.loading,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  displayMoreResults: () => dispatch(displayMoreResults()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Cards);\n","import * as d3 from 'd3';\n\nlet ChartLib = {};\n\nconst curateProps = _props => {\n  let props = Object.assign({}, _props);\n  props.margin = props.margin || { top: 0, right: 0, bottom: 0, left: 0 };\n  props.height = props.height || 400;\n  props.width = props.width || 400;\n  return props;\n};\n\n/**\n * Create chart foundation\n **/\n\nChartLib.createBase = (elem, props) => {\n  let brushElem = null;\n  const svg = d3.select(elem).append('svg');\n\n  if (props.xLabel) svg.append('text').attr('class', 'x label');\n  if (props.yLabel) svg.append('text').attr('class', 'y label');\n\n  // Group container for svg children\n  const g = svg.append('g').attr('class', 'group-container');\n\n  // Grid backgrounds\n  if (props.drawGrid) {\n    g.append('rect').attr('class', 'grid');\n    g.append('g').attr('class', 'x grid');\n    g.append('g').attr('class', 'y grid');\n  }\n\n  // Axes\n  g.append('g').attr('class', 'x axis');\n  g.append('g').attr('class', 'y axis');\n\n  // Brush\n  if (props.onBrush) brushElem = g.append('g').attr('class', 'brush');\n\n  // Specific geom containers\n  if (props.areaData) g.append('g').attr('class', 'area-container');\n  if (props.boxplotData) g.append('g').attr('class', 'boxplot-container');\n  if (props.histogramData) g.append('g').attr('class', 'histogram-container');\n  if (props.pointData) g.append('g').attr('class', 'point-container');\n  if (props.lineData) g.append('g').attr('class', 'line-container');\n  if (props.waffleData) g.append('g').attr('class', 'waffle-container');\n  if (props.forceData) g.append('g').attr('class', 'force-container');\n  if (props.swarmData) g.append('g').attr('class', 'swarm-container');\n\n  // Legends\n  if (props.legend) g.append('g').attr('class', 'legend-container');\n\n  return brushElem;\n};\n\n/**\n * Update chart base with data\n **/\n\nChartLib.updateBase = (elem, _props) => {\n  const props = curateProps(_props);\n  const svg = d3.select(elem).select('svg');\n  setSvgSize(svg, props);\n  transformGroupContainer(svg, props);\n  transformXAxis(svg, props);\n  if (props.drawGrid) addGrid(props);\n  if (props.xLabel) addXLabel(svg, props);\n  if (props.yLabel) addYLabel(svg, props);\n};\n\nconst setSvgSize = (svg, props) => {\n  if (props.resize) {\n    svg\n      .attr('viewBox', '0 0 ' + props.width + ' ' + props.height)\n      .attr('preserveAspectRatio', 'xMidYMid meet');\n  } else {\n    svg.attr('width', props.width).attr('height', props.height);\n  }\n};\n\nconst transformGroupContainer = (svg, props) => {\n  svg\n    .select('.group-container')\n    .attr('transform', 'translate(' + props.margin.left + ',' + props.margin.top + ')');\n};\n\nconst transformXAxis = (svg, props) => {\n  svg\n    .select('.x.axis')\n    .attr(\n      'transform',\n      'translate(0,' + (props.height - props.margin.top - props.margin.bottom) + ')'\n    );\n};\n\nconst addGrid = props => {\n  d3.select('.group-container')\n    .select('rect.grid')\n    .attr('class', 'grid')\n    .attr('width', props.width - props.margin.left - props.margin.right)\n    .attr('height', props.height - props.margin.top - props.margin.bottom);\n};\n\nconst addXLabel = (svg, props) => {\n  svg\n    .select('.x.label')\n    .attr('text-anchor', 'middle')\n    .attr('y', props.height - props.margin.bottom + 30)\n    .attr('x', props.width / 2)\n    .attr('dy', '.75em')\n    .text(props.xLabel);\n};\n\nconst addYLabel = (svg, props) => {\n  svg\n    .select('.y.label')\n    .attr('text-anchor', 'middle')\n    .attr('y', 1)\n    .attr('x', 0 - (props.height - props.margin.bottom) / 2)\n    .attr('dy', '.75em')\n    .attr('transform', 'rotate(-90)')\n    .text(props.yLabel);\n};\n\n/**\n * Get the geoms to be drawn\n **/\n\nChartLib.getGeoms = props => {\n  let geoms = [];\n\n  if (props.pointData) {\n    geoms.push({\n      data: props.pointData,\n      draw: ChartLib.drawPoint,\n    });\n  }\n\n  if (props.waffleData) {\n    geoms.push({\n      data: props.waffleData,\n      draw: ChartLib.drawWaffle,\n    });\n  }\n\n  return geoms;\n};\n\n/**\n * Get the domain for data to be plotted\n **/\n\nChartLib.getDomain = (data, props) => {\n  let domain = {};\n  domain.x = d3.extent(data, d => d[props.x || 'x']);\n  domain.y = d3.extent(data, d => d[props.y || 'y']);\n  if (props.xDomain) domain.x = props.xDomain;\n  if (props.yDomain) domain.y = props.yDomain;\n  return domain;\n};\n\n/**\n * Get the scales for a chart\n **/\n\nChartLib.getScales = (elem, _props, domain) => {\n  if (!domain) return null;\n  let scales = {};\n  const props = curateProps(_props);\n  const w = props.width - props.margin.right - props.margin.left;\n  const h = props.height - props.margin.top - props.margin.bottom;\n  const axes = { x: [0, w], y: [h, 0] };\n  Object.keys(axes).map(a => {\n    if (props[a + 'Scale']) {\n      switch (props[a + 'Scale']) {\n        case 'ordinal':\n          scales[a] = d3.scaleBand().domain(domain[a]).range(axes[a]);\n          return null;\n\n        case 'linear':\n          scales[a] = d3.scaleLinear().domain(domain[a]).range(axes[a]);\n          return null;\n\n        case 'inverse':\n          scales[a] = d3.scaleLinear().domain(domain[a]).range([axes[a][1], axes[a][0]]);\n          return null;\n\n        default:\n          console.warn('the requested', a, 'scale is invalid');\n      }\n    } else {\n      scales[a] = d3.scaleLinear().domain(domain[a]).range(axes[a]);\n    }\n    return null;\n  });\n  return scales;\n};\n\n/**\n * Add axes\n **/\n\nChartLib.updateAxes = (elem, props, scales, brush, brushElem) => {\n  if (!scales) return;\n  if (props.drawGrid === true) ChartLib.drawGrid(elem, props, scales);\n  const axes = ChartLib.getAxes(props, scales);\n\n  d3.select(elem)\n    .selectAll('g.x.axis')\n    .call(axes.x)\n    .selectAll('text')\n    .attr('y', () => (props.xLabelRotate ? 11 : 0))\n    .attr('x', () => (props.xLabelRotate ? 1 : 0))\n    .attr('dy', () => (props.xLabelRotate ? '.35em' : 0))\n    .style('text-anchor', () => (props.xLabelRotate ? 'start' : 'middle'))\n    .attr('transform', () =>\n      props.xLabelRotate ? 'rotate(' + props.xLabelRotate + ')' : 'rotate(0)'\n    );\n\n  d3.select(elem).selectAll('g.y.axis').transition().duration(1000).call(axes.y);\n\n  if (brush && brushElem) {\n    brushElem.call(brush);\n    brushElem\n      .select('.overlay')\n      .attr('width', props.width - props.margin.left - props.margin.right)\n      .attr('height', props.height - props.margin.top - props.margin.bottom);\n  }\n};\n\n/**\n * Get axes\n **/\n\nChartLib.getAxes = (props, scales) => {\n  return {\n    x: d3\n      .axisBottom(scales.x)\n      .ticks(props.xTicks)\n      .tickPadding(props.xTickPadding ? props.xTickPadding : 4)\n      .tickFormat(props.xTickFormat ? props.xTickFormat : d3.format('d')),\n    y: d3\n      .axisLeft(scales.y)\n      .ticks(props.yTicks)\n      .tickPadding(props.yTickPadding ? props.yTickPadding : 4)\n      .tickFormat(props.yTickFormat ? props.yTickFormat : d3.format('.1f')),\n  };\n};\n\n/**\n * Draw a background grid\n **/\n\nChartLib.drawGrid = (elem, props, scales) => {\n  const gridX = props => d3.axisBottom(scales.x).ticks(props.xTicks || 8);\n  const gridY = props => d3.axisLeft(scales.y).ticks(props.yTicks || 8);\n\n  d3.select(elem)\n    .select('.x.grid')\n    .transition()\n    .duration(1000)\n    .call(\n      gridX(props)\n        .tickSize(props.height - props.margin.top - props.margin.bottom)\n        .tickFormat('')\n    );\n\n  d3.select(elem)\n    .select('.y.grid')\n    .transition()\n    .duration(1000)\n    .call(\n      gridY(props)\n        .tickSize(-(props.width - props.margin.left - props.margin.right))\n        .tickFormat('')\n    );\n};\n\n/**\n * Draw geom: points\n **/\n\nChartLib.drawPoint = (elem, props, domain, scales, jitters) => {\n  const color = d3.scaleOrdinal('schemePaired');\n  const xKey = props.x || 'x';\n  const yKey = props.y || 'y';\n  const j = props.jitter || false;\n  window.chartLib = window.chartLib || {};\n  window.chartLib.jitters = window.chartLib.jitters || { x: [], y: [] };\n  if (!j) window.chartLib.jitters = { x: [], y: [] };\n\n  const dataKey = (d, i) => i;\n  const x = (d, i) => (j ? jitter(scales.x(d[xKey]), i, 'x') : scales.x(d[xKey]));\n  const y = (d, i) => (j ? jitter(scales.y(d[yKey]), i, 'y') : scales.y(d[yKey]));\n  const jitter = (val, idx, dim) => {\n    if (!window.chartLib.jitters[dim][idx]) {\n      window.chartLib.jitters[dim][idx] = Math.random() * 30 - 15;\n    }\n    return val + window.chartLib.jitters[dim][idx];\n  };\n\n  // enter\n  const g = d3.select(elem).select('.point-container');\n\n  const points = g.selectAll('.point-group').data(props.pointData, props.pointKey || dataKey);\n\n  const pointsEnter = points\n    .enter()\n    .append('g')\n    .attr('class', 'point-group')\n    .on('mouseout', d => (props.onMouseout ? props.onMouseout(d) : null))\n    .on('mouseover', d => (props.onMouseover ? props.onMouseover(d) : null))\n    .on('mouseenter', d => (props.onMouseenter ? props.onMouseenter(d) : null));\n\n  pointsEnter.append('circle').attr('class', 'point');\n  pointsEnter.append('text').attr('class', 'label').attr('stroke', '#000');\n\n  // enter + transition\n  points\n    .merge(pointsEnter)\n    .select('.point')\n    .transition()\n    .duration(1000)\n    .delay((d, i) => i * 2)\n    .attr('cx', x)\n    .attr('cy', y)\n    .attr('r', d => (props.r ? props.r : 3))\n    .attr('data-key', props.pointKey || dataKey)\n    .style('fill', d => (props.pointFill ? props.pointFill(d) : color(d.key)))\n    .style('stroke', d => (props.pointStroke ? props.pointStroke(d) : color(d.key)));\n\n  if (props.pointLabels) {\n    points\n      .merge(pointsEnter)\n      .select('.label')\n      .transition()\n      .duration(1000)\n      .text(d => (d.label ? d.label : ''))\n      .attr('x', (d, i) => x(d, i) + 6)\n      .attr('y', (d, i) => y(d, i) - 6);\n  }\n\n  // exit\n  points.exit().remove();\n};\n\n/**\n * Draw geom: waffle\n **/\n\nChartLib.drawWaffle = (elem, props, domain, scales) => {\n  const size = props.waffleSize || 10;\n  const maxCol = props.maxColumn || 10;\n  const levelMargin = props.levelMargin || 10;\n\n  const colCount = d => props.columnCounts[d.xLevel];\n\n  const x = (d, i) => {\n    // x offset by virtue of x's level\n    const level = scales.x(d.xLevel);\n    // x offset by virtue of x's column index\n    const cell = d.column * size;\n    // x offset to center level columns on axis label\n    const center = ((maxCol - colCount(d)) * size + levelMargin) / 2;\n    return level + cell + center;\n  };\n\n  const y = (d, i) => {\n    const offset = props.height - props.margin.bottom;\n    const y = (d.row + 1) * size;\n    return offset - y;\n  };\n\n  const waffle = d3\n    .select(elem)\n    .select('.waffle-container')\n    .selectAll('.waffle')\n    .data(props.waffleData, d => d[props.waffleKey] || ['waffle']);\n\n  const waffleEnter = waffle\n    .enter()\n    .append('rect')\n    .attr('class', 'waffle')\n    .attr('x', (d, i) => 10 * i * Math.random() - Math.random() * 10)\n    .attr('y', 0)\n    .on('click', (d, i) => {\n      d3.select(elem).selectAll('.waffle').classed('active', false);\n      d3.select(this).classed('active', true);\n      if (props.onClick) props.onClick(d, i);\n    });\n\n  waffle\n    .merge(waffleEnter)\n    .transition()\n    .duration(1000)\n    .attr('x', x)\n    .attr('y', y)\n    .attr('width', size)\n    .attr('height', size)\n    .attr('fill', (d, i) => props.color(d[props.colorKey]))\n    .attr('stroke-width', 1);\n\n  waffle.exit().remove();\n};\n\nexport default ChartLib;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ReactDOM from 'react-dom';\nimport ChartLib from './lib/chart-lib';\n\nexport default class Chart extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { brush: null };\n    this.create = this.create.bind(this);\n    this.update = this.update.bind(this);\n    this.destroy = this.destroy.bind(this);\n  }\n\n  componentDidMount() {\n    const el = ReactDOM.findDOMNode(this);\n    this.create(el, this.props);\n  }\n\n  componentDidUpdate(prevProps) {\n    const el = ReactDOM.findDOMNode(this);\n    this.update(el, this.props, this.state.brushElem);\n  }\n\n  componentWillUnmount() {\n    this.destroy(ReactDOM.findDOMNode(this));\n  }\n\n  create(elem, props) {\n    const brushElem = ChartLib.createBase(elem, props);\n    this.update(elem, props, brushElem);\n    this.setState({ brushElem: brushElem });\n  }\n\n  update(elem, props, brushElem) {\n    let brush, domain, scales;\n    ChartLib.updateBase(elem, props);\n    ChartLib.getGeoms(props).map(geom => {\n      domain = ChartLib.getDomain(geom.data, props);\n      scales = ChartLib.getScales(elem, props, domain);\n      geom.draw(elem, props, domain, scales);\n      return null;\n    });\n    if (props.onBrush && props.setBrush) {\n      brush = props.setBrush(brushElem, scales);\n    }\n    ChartLib.updateAxes(elem, props, scales, brush, brushElem);\n    if (props.legend) ChartLib.updateLegend(elem, props);\n  }\n\n  destroy() {}\n\n  render() {\n    return <div className='chart'></div>;\n  }\n}\n\nexport const WaffleDataProps = PropTypes.shape({\n  column: PropTypes.number.isRequired,\n  row: PropTypes.number.isRequired,\n  similarity: PropTypes.number.isRequired,\n  xLevel: PropTypes.string.isRequired,\n});\n\nChart.propTypes = {\n  color: PropTypes.func,\n  colorKey: PropTypes.string,\n  columnCounts: PropTypes.object,\n  height: PropTypes.number.isRequired,\n  margin: PropTypes.shape({\n    bottom: PropTypes.number.isRequired,\n    left: PropTypes.number.isRequired,\n    right: PropTypes.number.isRequired,\n    top: PropTypes.number.isRequired,\n  }).isRequired,\n  maxColumns: PropTypes.number,\n  onBrush: PropTypes.func,\n  onClick: PropTypes.func,\n  onMouseenter: PropTypes.func,\n  onMouseout: PropTypes.func,\n  onMouseover: PropTypes.func,\n  setBrush: PropTypes.func,\n  waffleData: PropTypes.arrayOf(WaffleDataProps),\n  waffleKey: PropTypes.string,\n  width: PropTypes.number.isRequired,\n  x: PropTypes.string,\n  xLabel: PropTypes.string,\n  xLabelRotate: PropTypes.number,\n  xScale: PropTypes.string,\n  yScale: PropTypes.string,\n  xTickFormat: PropTypes.func,\n  yLabel: PropTypes.string,\n};\n","import * as d3 from 'd3';\n\nexport const colors = ['#EFE0DB', '#F5D66E', '#F1A21A', '#E6653E'];\n\nexport const colorScale = d3.scaleOrdinal().domain([50, 67, 84, 100]).range(colors);\n","import React from 'react';\nimport { colors } from './lib/color-lib';\n\nconst Legend = props => {\n  const min = props.domain && props.domain[0] ? props.domain[0] : 50;\n  const max = props.domain && props.domain[1] ? props.domain[1] : 100;\n  const percents = 'percents' in props ? props.percents : true;\n  return (\n    <div className='chart-legend'>\n      <span>{parse(min, percents)}</span>\n      <div className='swatches'>\n        {colors.map(c => (\n          <div key={c} className='swatch' style={{ background: c }} />\n        ))}\n      </div>\n      <span>{parse(max, percents)}</span>\n    </div>\n  );\n};\n\nconst parse = (val, percents) => {\n  return percents ? parseInt(val) + '%' : parseInt(val);\n};\n\nexport default Legend;\n","export default __webpack_public_path__ + \"static/media/default-headshot.5ad2de77.jpg\";","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport Chart, { WaffleDataProps } from './Chart';\nimport Legend from './Legend';\nimport Loader from '../partials/Loader';\nimport Card, { CardProps } from '../cards/Card';\nimport headshot from '../../assets/images/authors/default-headshot.jpg';\nimport { Link } from 'react-router-dom';\nimport { colorScale } from './lib/color-lib';\nimport { setWaffleFeature, getWaffleActive } from '../../actions/waffle';\n\nclass Waffle extends React.Component {\n  render() {\n    return (\n      <div className='waffle-card-wrapper'>\n        <div className='waffle-card-container'>\n          <div className='waffle-card-controls'>\n            <span className='label'>Visualize similar passages by:</span>\n            {options.map((o, i) => (\n              <Button\n                key={i}\n                active={this.props.feature}\n                feature={o.feature}\n                label={o.label}\n                setFeature={this.props.setFeature}\n              />\n            ))}\n            <Legend />\n            <Link to='/' className='close-visualization-wrapper'>\n              <div className='close-visualization' />\n            </Link>\n          </div>\n          <div className='result waffle-chart-card'>\n            <div className='result-top row align-center'>\n              <div className='result-title'>\n                <span>All passages similar to </span>\n                <span>\n                  <i>{this.props.title}</i>\n                </span>\n              </div>\n            </div>\n            <div className='result-body row'>\n              <div className='headshot-container col justify-center align-center'>\n                <div\n                  className='headshot'\n                  style={{\n                    backgroundImage: 'url(' + getImage(this.props.image) + ')',\n                  }}\n                />\n                <div className='headshot-label'>{this.props.author}</div>\n              </div>\n              <WafflePlot />\n            </div>\n          </div>\n          {this.props.active ? <WaffleCards {...this.props} /> : <span />}\n        </div>\n      </div>\n    );\n  }\n}\n\nconst Button = props => {\n  return (\n    <div\n      className={props.feature === props.active ? 'waffle-button active' : 'waffle-button'}\n      onClick={props.setFeature.bind(null, props.feature)}\n    >\n      {props.label}\n    </div>\n  );\n};\n\nconst WaffleCards = props => {\n  return (\n    <div className='waffle-card-result-container results-container'>\n      <div className='result-pair row'>\n        <Card key='key-source' type={props.type} result={props.active} />\n        <Card\n          key='key-target'\n          type={props.type === 'source' ? 'target' : 'source'}\n          result={props.active}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst getImage = image => {\n  return image ? (image.substring(0, 4) === 'src/' ? image.substring(3) : image) : headshot;\n};\n\nconst options = [\n  { feature: 'author', label: 'Author' },\n  { feature: 'segment_ids', label: 'Segment' },\n  { feature: 'year', label: 'Year' },\n];\n\n/**\n * Plot\n **/\n\nconst StatelessWafflePlot = props => {\n  return (\n    <div className='waffle-chart hide-y-axis'>\n      {props.data.length > 0 ? (\n        <Chart\n          height={236}\n          margin={{ top: 0, right: 80, bottom: 75, left: 0 }}\n          xLabel={''}\n          yLabel={''}\n          xScale={'ordinal'}\n          xTickFormat={d => d}\n          xLabelRotate={25}\n          yDomain={[1, 20]}\n          waffleKey={'_id'}\n          colorKey={'similarity'}\n          color={colorCell}\n          waffleData={props.data}\n          width={props.width}\n          columnCounts={props.columnCounts}\n          maxColumn={props.maxColumn}\n          x={props.feature}\n          xDomain={props.xDomain}\n          onClick={props.getActive}\n        />\n      ) : (\n        <Loader />\n      )}\n    </div>\n  );\n};\n\nconst colorCell = d => {\n  return colorScale(parseInt(d));\n};\n\nlet mapStateToProps = state => ({\n  data: state.waffle.data,\n  width: state.waffle.width,\n  xDomain: state.waffle.xDomain,\n  columnCounts: state.waffle.columnCounts,\n  maxColumn: state.waffle.maxColumn,\n});\n\nlet mapDispatchToProps = dispatch => ({\n  getActive: (d, i) => dispatch(getWaffleActive(d, i)),\n});\n\nconst WafflePlot = connect(mapStateToProps, mapDispatchToProps)(StatelessWafflePlot);\n\n/**\n * Plot\n **/\n\nStatelessWafflePlot.propTypes = {\n  columnCounts: PropTypes.object.isRequired,\n  data: PropTypes.arrayOf(WaffleDataProps).isRequired,\n  maxColumn: PropTypes.number,\n  width: PropTypes.number.isRequired,\n  xDomain: PropTypes.arrayOf(PropTypes.string).isRequired,\n  getActive: PropTypes.func.isRequired,\n};\n\n/**\n * Container\n **/\n\nWaffle.propTypes = {\n  active: CardProps,\n  author: PropTypes.string.isRequired,\n  data: PropTypes.arrayOf(WaffleDataProps).isRequired,\n  feature: PropTypes.string.isRequired,\n  history: PropTypes.shape({\n    push: PropTypes.func.isRequired,\n  }),\n  image: PropTypes.string,\n  location: PropTypes.object,\n  match: PropTypes.object,\n  setFeature: PropTypes.func.isRequired,\n  title: PropTypes.string.isRequired,\n  type: PropTypes.string.isRequired,\n};\n\nmapStateToProps = state => ({\n  type: state.waffle.type,\n  feature: state.waffle.feature,\n  author: state.waffle.author,\n  title: state.waffle.title,\n  image: state.waffle.image,\n  data: state.waffle.data,\n  active: state.waffle.active,\n});\n\nmapDispatchToProps = dispatch => ({\n  setFeature: feature => dispatch(setWaffleFeature(feature)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Waffle);\n","import * as d3 from 'd3';\nimport {\n  sankey as d3sankey,\n  sankeyLinkHorizontal as d3sankeyLinkHorizontal,\n  sankeyCenter as d3sankeyCenter,\n} from 'd3-sankey';\nimport { colors } from './color-lib';\nimport { history } from '../../../store';\n\nexport const plot = props => {\n  let { svg, data, setField, setTypeaheadQuery, fetchSearchResults } = { ...props };\n\n  // sort the nodes by how many edges they have\n  let counts = {};\n  data.links.map(e => (counts[e.source] = counts[e.source] ? counts[e.source] + 1 : 1));\n  data.nodes.sort((a, b) => {\n    const ca = counts[a.sankeyId] || 0;\n    const cb = counts[b.sankeyId] || 0;\n    return cb - ca;\n  });\n\n  const margin = { top: 10, right: 210, bottom: 10, left: 210 },\n    width = 900 - margin.left - margin.right,\n    height = data.nodes.length * 30 - margin.top - margin.bottom;\n\n  const linkColor = d3.scaleThreshold().domain([0, 60, 70, 80]).range(colors);\n\n  svg = d3\n    .select(svg)\n    .attr('width', width + margin.left + margin.right)\n    .attr('height', height + margin.top + margin.bottom)\n    .append('g')\n    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n  const sankey = d3sankey()\n    .nodeId(d => d.sankeyId)\n    .nodeAlign(d3sankeyCenter)\n    .nodeSort(null)\n    .nodeWidth(15)\n    .nodePadding(18)\n    .extent([\n      [0, 5],\n      [width, height - 5],\n    ]);\n\n  const { nodes, links } = sankey({\n    nodes: data.nodes.map(d => Object.assign({}, d)),\n    links: data.links.map(d => Object.assign({}, d)),\n  });\n\n  const handleLinkClick = d => {\n    setTypeaheadQuery('');\n    setField({\n      earlierLater: 'earlier',\n      field: 'fileId',\n      value: d.source.id,\n    });\n    setField({\n      earlierLater: 'later',\n      field: 'fileId',\n      value: d.target.id,\n    });\n    fetchSearchResults();\n    history.push('/cards');\n  };\n\n  const link = svg\n    .append('g')\n    .attr('class', 'links')\n    .selectAll('.link')\n    .data(links.sort((b, a) => b.width - a.width))\n    .enter()\n    .append('path')\n    .attr('class', d => `link source-${d.source.id} target-${d.target.id}`)\n    .attr('fill', 'none')\n    .attr('d', d3sankeyLinkHorizontal())\n    .style('stroke-width', d => Math.max(1, d.width))\n    .attr('stroke', d => linkColor(d.similarity))\n    .on('click', d => handleLinkClick(d));\n\n  link.append('title').text(d => d.source.label + ' \\n' + d.target.label);\n\n  const activateLinks = d => {\n    if (d.sankeyId.includes('earlier'))\n      d3.selectAll(`.link.source-${d.id}`).classed('active', true);\n    if (d.sankeyId.includes('later')) d3.selectAll(`.link.target-${d.id}`).classed('active', true);\n  };\n\n  const deactivateLinks = () => {\n    d3.selectAll('.link').classed('active', false);\n  };\n\n  const isSafari = () => {\n    return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  };\n\n  const node = svg\n    .append('g')\n    .attr('class', 'nodes')\n    .selectAll('.node')\n    .data(nodes)\n    .enter()\n    .append('g')\n    .attr('class', 'node')\n    .attr('transform', d => 'translate(' + d.x0 + ',' + d.y0 + ')');\n\n  node\n    .append('rect')\n    .attr('height', d => d.y1 - d.y0)\n    .attr('width', sankey.nodeWidth())\n    .style('fill', d => '#f3f3f3')\n    .style('stroke', d => '#999999')\n    .on('mouseenter', activateLinks)\n    .on('mouseout', deactivateLinks)\n    .append('title')\n    .text(d => d.label);\n\n  node\n    .append('foreignObject')\n    .attr('class', d => {\n      return d.sankeyId.includes('earlier') ? 'earlier' : 'later';\n    })\n    .attr('x', d => (d.sankeyId.includes('earlier') ? -205 : 20))\n    .attr('y', d => (d.y1 - d.y0 >= 20 ? 0 : -(20 - (d.y1 - d.y0)) / 2))\n    .attr('width', 200)\n    .attr('height', d => Math.max(d.y1 - d.y0, 20))\n    .append('xhtml:body')\n    .attr('xmlns', 'http://www.w3.org/1999/xhtml')\n    .attr('class', () => (isSafari() ? '' : 'center-vertically'))\n    .text(d => (d.label.length < 25 ? d.label : d.label.substring(0, 25) + '...'))\n    .on('mouseenter', activateLinks)\n    .on('mouseout', deactivateLinks);\n};\n","import React, { useRef, useEffect, useState } from 'react';\nimport { plot } from './lib/sankey-lib';\nimport { connect } from 'react-redux';\nimport * as searchActions from '../../actions/search';\nimport * as typeaheadActions from '../../actions/typeahead';\nimport * as _ from 'lodash';\n\nconst Sankey = props => {\n  const ref = useRef();\n  const [initialized, setInitialized] = useState(false);\n\n  useEffect(() => {\n    const getData = (sortIndex, labelToFileIds) => {\n      // wait for the match index to load before showing plot\n      if (!sortIndex || Object.values(sortIndex).length === 0) return;\n      if (!labelToFileIds || Object.values(labelToFileIds).length === 0) return;\n      // obtain a mapping from file id to label\n      let fileIdToLabel = {};\n      for (const [label, fileIds] of Object.entries(labelToFileIds)) {\n        fileIds.forEach(fileId => {\n          fileIdToLabel[fileId] = label;\n        });\n      }\n      // obtain a mapping from match id to match objects\n      let matchIdMap = {};\n      sortIndex.forEach(i => {\n        const row = searchActions.parseSortIndexRow(i);\n        matchIdMap[row.earlierId] = matchIdMap[row.earlierId] || [];\n        matchIdMap[row.earlierId].push(row.laterId);\n      });\n      // parse the data to be represented\n      const nodes = {};\n      const links = {};\n      sortIndex.forEach(i => {\n        const row = searchActions.parseSortIndexRow(i);\n        const a = row.earlierId;\n        const b = row.laterId;\n        // create node labels\n        const aLabel = fileIdToLabel[a];\n        const bLabel = fileIdToLabel[b];\n        // add earlier/later prefixes so nodes are stacked in two columns\n        const sankeyIdA = 'earlier-' + a.toString();\n        const sankeyIdB = 'later-' + b.toString();\n        // create the nodes\n        const aNode = { id: a, label: aLabel, sankeyId: sankeyIdA };\n        const bNode = { id: b, label: bLabel, sankeyId: sankeyIdB };\n        // add the nodes\n        nodes[sankeyIdA] = aNode;\n        nodes[sankeyIdB] = bNode;\n        // update the edges\n        links[sankeyIdA] = links[sankeyIdA] || {};\n        links[sankeyIdA][sankeyIdB] = links[sankeyIdA][sankeyIdB] || {\n          count: 0,\n          similarity: [],\n        };\n        links[sankeyIdA][sankeyIdB]['count'] += 1;\n        links[sankeyIdA][sankeyIdB]['similarity'].push(row.similarity);\n      });\n\n      const l = [];\n      Object.keys(links).forEach(a => {\n        Object.keys(links[a]).forEach(b => {\n          l.push({\n            source: a,\n            target: b,\n            similarity: _.mean(links[a][b]['similarity']),\n            count: links[a][b]['count'],\n            value: links[a][b]['count'],\n          });\n        });\n      });\n\n      return {\n        nodes: Object.values(nodes),\n        links: l,\n      };\n    };\n\n    if (initialized || !props.sortIndex || !props.labelToFileIds) return;\n    setInitialized(true);\n    const data = getData(props.sortIndex, props.labelToFileIds);\n    plot({\n      svg: ref.current,\n      data: data,\n      setField: props.setField,\n      setTypeaheadQuery: props.setTypeaheadQuery,\n      fetchSearchResults: props.fetchSearchResults,\n    });\n  }, [\n    initialized,\n    props.sortIndex,\n    props.labelToFileIds,\n    props.setField,\n    props.setTypeaheadQuery,\n    props.fetchSearchResults,\n  ]);\n\n  return (\n    <div className='sankey-wrap'>\n      <svg ref={ref} id='sankey-plot' />\n    </div>\n  );\n};\n\nconst mapStateToProps = state => ({\n  typeaheadField: state.typeahead.field,\n  labelToFileIds: state.typeahead.fileIds ? state.typeahead.fileIds[state.typeahead.field] : null,\n  sortIndex: state.search.sortIndex,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  fetchSearchResults: () => dispatch(searchActions.fetchSearchResults()),\n  setTypeaheadQuery: s => dispatch(typeaheadActions.setTypeaheadQuery(s)),\n  setField: obj => dispatch(searchActions.setAdvancedFilterField(obj)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Sankey);\n","import * as d3 from 'd3';\nimport { fetchJSONFile } from './ajax';\n\nexport const toggleJitter = () => ({\n  type: 'TOGGLE_JITTER',\n});\n\nexport const removeZoom = () => ({\n  type: 'REMOVE_ZOOM',\n});\n\nexport const setY = y => ({\n  type: 'SET_Y',\n  y: y,\n});\n\nexport const scatterplotRequestFailed = () => ({\n  type: 'SCATTERPLOT_REQUEST_FAILED',\n});\n\nexport const receiveResults = obj => ({\n  type: 'RECEIVE_SCATTERPLOT_RESULTS',\n  obj: obj,\n});\n\nexport const setTooltip = obj => ({\n  type: 'SET_TOOLTIP',\n  obj: obj,\n});\n\nexport const setDomains = domains => {\n  return (dispatch, getState) => {\n    dispatch({ type: 'SET_DOMAINS', domains: domains });\n    dispatch(fetchScatterplotResults());\n  };\n};\n\nexport const resetZoom = () => {\n  return dispatch => {\n    dispatch(fetchScatterplotResults());\n  };\n};\n\nexport const setUnit = unit => {\n  return dispatch => {\n    dispatch({ type: 'SET_UNIT', unit: unit });\n    dispatch(fetchScatterplotResults());\n  };\n};\n\nexport const setStatistic = stat => {\n  return dispatch => {\n    dispatch({ type: 'SET_STATISTIC', statistic: stat });\n    dispatch(fetchScatterplotResults());\n  };\n};\n\nexport const setUse = use => {\n  return dispatch => {\n    dispatch({ type: 'SET_USE', use: use });\n    dispatch(fetchScatterplotResults());\n  };\n};\n\nexport const fetchScatterplotResults = () => {\n  return (dispatch, getState) => {\n    dispatch({ type: 'FETCH_SCATTERPLOT_RESULTS' });\n    const props = getScatterplotProps(getState());\n    const { use, unit, stat } = props;\n    return fetchJSONFile(`/api/scatterplots/${use}-${unit}-${stat}.json`)\n      .then(json => {\n        const state = getState();\n        const yDomain = state.scatterplot.yDomains;\n        const xDomain = state.scatterplot.xDomain;\n\n        const filteredResults = json.filter(item => {\n          // if there's an xdomain, filter on it\n          if (yDomain && yDomain.length === 2) {\n            const [minYear, maxYear] = d3.extent(yDomain);\n            const itemYear = item.target_year;\n            if (itemYear < minYear || itemYear > maxYear) {\n              return false;\n            }\n          }\n          // if theres a ydomain filter on it\n          if (xDomain.length === 2) {\n            const [minX, maxX] = d3.extent(xDomain);\n            const itemSimiliarty = item.similarity;\n            if (itemSimiliarty < minX || itemSimiliarty > maxX) {\n              return false;\n            }\n          }\n          return true;\n        });\n        dispatch(parseResults(filteredResults));\n      })\n      .catch(err => {\n        dispatch(scatterplotRequestFailed());\n      });\n  };\n};\n\nconst getScatterplotProps = state => {\n  return {\n    use: getUse(state.scatterplot.use),\n    unit: getUnit(state.scatterplot.unit),\n    stat: state.scatterplot.statistic,\n  };\n};\n\nconst getUse = use => (use === 'earlier' ? 'target' : 'source');\n\nconst getUnit = unit => {\n  if (unit === 'passage') return 'segment_ids';\n  if (unit === 'author') return 'author';\n  if (unit === 'book') return 'file_id';\n  return 'segment_ids';\n};\n\n// set the full and displayed domains\nconst getDomains = (data, _state) => {\n  return {\n    x: d3.extent(data, d => d.similarity),\n    y: d3.extent(data, d => d[getUse(_state.use) + '_year']),\n  };\n};\n\nconst parseResults = (data, options) => {\n  return (dispatch, getState) => {\n    const state = getState();\n    const domains = getDomains(data, state.scatterplot);\n    for (let i = 0; i < 20; i++) {\n      try {\n        data[i].label = i + 1;\n      } catch (e) {}\n    }\n    let args = {\n      data: data,\n      xDomain: domains.x,\n      yDomain: domains.y,\n      zoomed: false,\n    };\n    dispatch(receiveResults(args));\n  };\n};\n\nexport const getUnitFromUrl = () => {\n  return window.location.href.split('/#')[1].substring(1).split('=')[1];\n};\n","import React from 'react';\nimport * as d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { colors } from './lib/color-lib';\nimport Chart from './Chart';\nimport Legend from './Legend';\nimport Loader from '../partials/Loader';\nimport {\n  setY,\n  setUse,\n  setUnit,\n  resetZoom,\n  setTooltip,\n  setStatistic,\n  toggleJitter,\n  setDomains,\n} from '../../actions/scatterplot';\n\nconst Scatterplot = props => {\n  return (\n    <div className='scatterplot-container flex-1'>\n      <div className='scatterplot hide-x-grid flex-1'>\n        <IntroText {...props} />\n        <Controls {...props} />\n        <div className='row align-start justify-center'>\n          <Left {...props} />\n          <Right {...props} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst IntroText = props => {\n  return (\n    <>\n      <h1>Popular {props.unit}s</h1>\n      <div>\n        <span>The chart below displays the most popular </span>\n        <span>{props.unit}s </span>\n        <span>within your corpus. Hover over individual points for more information.</span>\n      </div>\n    </>\n  );\n};\n\nconst Controls = props => {\n  return (\n    <div className='controls'>\n      <span>{'Show ' + props.unit + 's most similar to'}</span>\n      <select onChange={props.setUse} value={props.use}>\n        <option value={'earlier'}>Earlier</option>\n        <option value={'later'}>Later</option>\n      </select>\n      <span>{props.unit + 's based on'}</span>\n      <select onChange={props.setStatistic} value={props.statistic}>\n        <option value='sum'>Sum</option>\n        <option value='mean'>Mean</option>\n      </select>\n      <span>of passage similarity</span>\n    </div>\n  );\n};\n\nconst Left = props => {\n  return (\n    <div className='left'>\n      <LeftControls {...props} />\n      <LeftChart {...props} />\n    </div>\n  );\n};\n\nconst Right = props => {\n  return (\n    <div className='col'>\n      {props.tooltip.title ? <Tooltip {...props} /> : null}\n      <Table {...props} />\n      <div className='controls-lower'>\n        <div\n          className={props.zoomed ? 'reset-button visible' : 'reset-button'}\n          onClick={props.resetZoom}\n        >\n          Reset zoom\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst LeftControls = props => {\n  return (\n    <div className='row align-center'>\n      <span className='swatch-label'>Similarity</span>\n      <Legend domain={props.xDomain} percents={props.statistic === 'mean'} />\n      <div className='jitter row align-center'>\n        <span>Jitter</span>\n        <input type='checkbox' onChange={props.toggleJitter} value={props.jitter} />\n      </div>\n    </div>\n  );\n};\n\nconst LeftChart = props => {\n  const handleMouseover = d => {\n    const container = d3.select('.scatterplot-container').node();\n    const mouseLocation = d3.mouse(container);\n    props.setTooltip({\n      x: mouseLocation[0],\n      y: mouseLocation[1],\n      title: d.title,\n      author: d.author,\n      year: d[props.y],\n    });\n  };\n\n  const handleMouseout = d => {\n    props.setTooltip({\n      x: null,\n      y: null,\n      title: '',\n      author: '',\n      year: null,\n    });\n  };\n\n  const setBrush = (brushElem, scales) => {\n    const brush = d3.brush();\n    return brush.on('end', () => {\n      handleBrush(scales, brush, brushElem);\n    });\n  };\n\n  const handleBrush = (scales, brush, brushElem) => {\n    if (!d3.event.sourceEvent || !d3.event.selection) return;\n    // find min, max of each axis in axis units (not pixels)\n    const x = [\n      scales.x.invert(d3.event.selection[0][0]),\n      scales.x.invert(d3.event.selection[1][0]),\n    ];\n    const y = [\n      scales.y.invert(d3.event.selection[0][1]),\n      scales.y.invert(d3.event.selection[1][1]),\n    ];\n    // only brush if there are observations in brushed area\n    const selected = props.data.filter(d => {\n      return (\n        d.similarity >= x[0] && d.similarity <= x[1] && d[props.y] >= y[0] && d[props.y] <= y[1]\n      );\n    });\n    if (selected.length) props.setDomains({ x: x, y: y });\n    else props.resetZoom();\n    // clear the brush\n    brushElem.call(brush.move, null);\n  };\n\n  const colorScale = d3.scaleQuantize().domain(props.xDomain).range(colors);\n\n  return props.data.length === 0 ? (\n    <div className='col flex-1 justify-center align-center'>\n      <Loader />\n    </div>\n  ) : (\n    <Chart\n      width={480}\n      height={600}\n      margin={{ top: 15, right: 20, bottom: 20, left: 40 }}\n      pointData={props.data}\n      pointStroke={d => '#fff'}\n      pointFill={d => colorScale(d.similarity)}\n      pointLabels={true}\n      pointKey={d => d.key}\n      jitter={props.jitter}\n      r={8}\n      x={'similarity'}\n      xTicks={7}\n      xDomain={props.xDomain}\n      xTickFormat={d => Math.round(d) / 100}\n      y={props.y}\n      yTicks={5}\n      yScale={'inverse'}\n      yDomain={props.yDomain}\n      yTickFormat={d => parseInt(d)}\n      drawGrid={true}\n      setBrush={setBrush}\n      onBrush={handleBrush}\n      resize={false}\n      onMouseover={handleMouseover}\n      onMouseout={handleMouseout}\n    />\n  );\n};\n\nconst Tooltip = props => {\n  return (\n    <div\n      className='tooltip'\n      style={{\n        left: props.tooltip.x + 5,\n        top: props.tooltip.y + 30,\n      }}\n    >\n      <div className='title'>{props.tooltip.title}</div>\n      <div className='author'>{props.tooltip.author + ', ' + props.tooltip.year}</div>\n    </div>\n  );\n};\n\nconst Table = props => {\n  return (\n    <div className='right'>\n      <div className='scatterplot-label'>\n        <span>Top {Math.min(20, props.data.length)} most popular </span>\n        <span>{props.unit}s </span>\n        <span>in current view</span>\n      </div>\n      <div className='clear-both' />\n      <hr />\n      <table>\n        <tbody>\n          {props.data.slice(0, 20).map((r, i) => (\n            <Row key={i} unit={props.unit} row={r} />\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nconst Row = props => {\n  return (\n    <tr className='book'>\n      <td className='book-number'>{props.row.label}.</td>\n      <td dangerouslySetInnerHTML={getRowText(props)} />\n    </tr>\n  );\n};\n\nconst getRowText = props => {\n  switch (props.unit) {\n    case 'passage':\n      const words = props.row.match.split(' ');\n      return { __html: '...' + words.slice(0, 20).join(' ') + '...' };\n    case 'author':\n      return { __html: props.row.author };\n    case 'book':\n      return { __html: props.row.title };\n    default:\n      return '';\n  }\n};\n\nScatterplot.propTypes = {\n  data: PropTypes.arrayOf(\n    PropTypes.shape({\n      author: PropTypes.string.isRequired,\n      key: PropTypes.isRequired,\n      label: PropTypes.number,\n      match: PropTypes.string.isRequired,\n      similarity: PropTypes.number.isRequired,\n      source_year: PropTypes.number.isRequired,\n      target_year: PropTypes.number.isRequired,\n      title: PropTypes.string.isRequired,\n    })\n  ),\n  history: PropTypes.shape({\n    push: PropTypes.func.isRequired,\n  }),\n  jitter: PropTypes.bool.isRequired,\n  location: PropTypes.object,\n  match: PropTypes.object,\n  resetZoom: PropTypes.func.isRequired,\n  setStatistic: PropTypes.func.isRequired,\n  setTooltip: PropTypes.func.isRequired,\n  setUnit: PropTypes.func.isRequired,\n  setY: PropTypes.func.isRequired,\n  statistic: PropTypes.string.isRequired,\n  toggleJitter: PropTypes.func.isRequired,\n  tooltip: PropTypes.shape({\n    author: PropTypes.string.isRequired,\n    title: PropTypes.string.isRequired,\n    x: PropTypes.isRequired,\n    y: PropTypes.isRequired,\n  }),\n  unit: PropTypes.string.isRequired,\n  use: PropTypes.string.isRequired,\n  xDomain: PropTypes.arrayOf(PropTypes.number).isRequired,\n  y: PropTypes.string.isRequired,\n  yDomain: PropTypes.arrayOf(PropTypes.number).isRequired,\n};\n\nconst mapStateToProps = state => ({\n  unit: state.scatterplot.unit,\n  statistic: state.scatterplot.statistic,\n  use: state.scatterplot.use,\n  jitter: state.scatterplot.jitter,\n  y: state.scatterplot.y,\n  data: state.scatterplot.data,\n  tooltip: state.scatterplot.tooltip,\n  xDomain: state.scatterplot.xDomain,\n  yDomain: state.scatterplot.yDomain,\n  zoomed: state.scatterplot.zoomed,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setY: y => dispatch(setY(y)),\n  setUse: e => dispatch(setUse(e.target.value)),\n  setUnit: unit => dispatch(setUnit(unit)),\n  setStatistic: e => dispatch(setStatistic(e.target.value)),\n  setTooltip: obj => dispatch(setTooltip(obj)),\n  resetZoom: () => dispatch(resetZoom()),\n  toggleJitter: () => dispatch(toggleJitter()),\n  setDomains: obj => dispatch(setDomains(obj)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Scatterplot);\n","import { connect } from 'react-redux';\nimport { orderBy } from 'lodash';\nimport { Link } from 'react-router-dom';\nimport * as typeaheadActions from '../../actions/typeahead';\nimport * as searchActions from '../../actions/search';\nimport { history } from '../../store';\n\nconst Works = props => {\n  const sorted = orderBy(props.metadata, 'author');\n\n  const onClick = (title, e) => {\n    e.preventDefault();\n    props.clearAdvancedFilterType('earlier');\n    props.clearAdvancedFilterType('later');\n    props.setTypeaheadField('title');\n    props.setTypeaheadQuery(title);\n    props.fetchSearchResults();\n    history.push('/cards');\n  };\n\n  return (\n    <div id='page-works'>\n      <h1>Works</h1>\n      <div>\n        {sorted.map((m, idx) => (\n          <div className='work-row row align-center' key={idx}>\n            <div className='work-author'>{m.author}, </div>\n            {m.matches ? (\n              <Link to={'/cards'} onClick={e => onClick(m.title, e)}>\n                {m.title}\n              </Link>\n            ) : (\n              <div className='work-title'>{m.title}</div>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = state => ({\n  metadata: state.typeahead.metadata || [],\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setSearchLoading: bool => dispatch(searchActions.setSearchLoading(bool)),\n  setTypeaheadQuery: val => dispatch(typeaheadActions.setTypeaheadQuery(val)),\n  setTypeaheadField: val => dispatch(typeaheadActions.setTypeaheadField(val)),\n  clearAdvancedFilterType: val => dispatch(searchActions.clearAdvancedFilterType(val)),\n  fetchSearchResults: () => dispatch(searchActions.fetchSearchResults()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Works);\n","import { useRef, useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport * as viewerActions from '../../actions/viewer';\nimport Card from '../cards/Card';\nimport Loader from '../partials/Loader';\nimport * as d3 from 'd3';\n\nconst Viewer = props => {\n\n  const offscreenRef = useRef();\n  const [rows, setRows] = useState([]);\n  const [matchMap, setMatchMap] = useState({});\n  const [selectedRow, setSelectedRow] = useState({idx: null, matches: []});\n\n  const loaded = props.match.params.id.toString() === props.fileId.toString() && rows.length;\n\n  useEffect(() => {\n    // load the data for the requested file\n    props.getViewerData(props.match.params.id);\n    // create a map from fileId window to [matches]\n    setRows(getRows(offscreenRef, props));\n    setMatchMap(getMatchMap(props));\n  }, [props, props.match.params.id, props.fileId, props.matches])\n\n  return (\n    <div id='page-viewer' className='row justify-center'>\n      <div id='offscreen' ref={offscreenRef} />\n      {loaded\n        ? (\n            <div id='viewer-text-columns'>\n              <div id='viewer-left' className='viewer-text-column'>\n                {rows.map((r, ridx) => (\n                  <TextRow\n                    key={ridx}\n                    r={r}\n                    ridx={ridx}\n                    selectedRow={selectedRow}\n                    matchMap={matchMap}\n                    setSelectedRow={setSelectedRow} />\n                ))}\n              </div>\n              <div id='viewer-right' className='viewer-text-column'>\n                {selectedRow.matches.length\n                  ? selectedRow.matches.map((m, midx) => (\n                      <MatchRow key={midx} m={m} otherId={props.fileId.toString()} />\n                    ))\n                  : null\n                }\n              </div>\n            </div>\n          )\n        : <div className='col align-center justify-center'>\n            <Loader />\n          </div>\n      }\n    </div>\n  )\n}\n\nconst TextRow = props => {\n\n  // get the list of objects for a given row\n  const getRowMatches = (row, matchMap) => {\n    let ids = new Set();\n    let matches = [];\n    row.forEach(r => {\n      (r.windows || []).forEach(w => {\n        // get the matches for this window\n        if (matchMap[w]) matchMap[w].forEach(m => {\n          if (!ids.has(m._id)) {\n            ids.add(m._id);\n            matches.push(m);\n          }\n        })\n      })\n    });\n    return matches;\n  }\n\n  // get the innerHTML content for a row of word objects\n  const getRowText = (row) => {\n    return row.map(w => w.word).join(' ');\n  }\n\n  const onClick = (ridx, matches) => {\n    props.setSelectedRow({\n      idx: ridx,\n      matches: matches,\n    })\n  }\n\n  const getClassName = hasWindows => {\n    let s = 'row space-between';\n    if (props.selectedRow.idx !== null) {\n      if (Math.abs(props.selectedRow.idx - props.ridx) < 5) {\n        s += ' selected-context';\n      } else {\n        s += ' not-selected';\n      }\n    }\n    if (props.selectedRow.idx === props.ridx) s += ' selected';\n    if (hasWindows) {\n      s += ' selectable';\n    } else {\n      s += ' not-selectable';\n    }\n    return s;\n  }\n\n  const { r, ridx, matchMap } = {...props}\n  const matches = getRowMatches(r, matchMap);\n  const hasWindows = r.filter(i => i.windows && i.windows.length).length > 0;\n\n  // get the color for the color block\n  var colorScale = d3.scaleLinear().domain([0, 10]).range(['#eee', '#444']);\n\n  return (\n    <div className={getClassName(hasWindows)}\n        onClick={e => matches.length ? onClick(ridx, matches) : null}>\n      <div className='line' dangerouslySetInnerHTML={{__html: getRowText(r)}} />\n      <div className='match-count' style={{\n        background: hasWindows\n          ? colorScale(Math.min(matches.length, 10))\n          : colorScale(0)\n      }} />\n    </div>\n  )\n}\n\nconst getMatchMap = (props) => {\n  if (!props.fileId) return;\n  let d = {};\n  const fileId = parseInt(props.fileId);\n  props.matches.forEach(m => {\n    const segments = parseInt(m.source_file_id) === fileId\n      ? m.source_segment_ids\n      : m.target_segment_ids;\n    segments.forEach(s => {\n      d[s] = d[s] || [];\n      d[s].push(m);\n    })\n  })\n  return d;\n}\n\nconst getRows = (offscreenRef, props) => {\n  // transform the word array into a sequence of (word, windowId) tuples\n  let words = [];\n  var windows = [];\n  let windowIndex = -1; // -1 because we increment on the first word\n  (props.words || []).forEach((word, wordIndex) => {\n    if (wordIndex % props.config.window_slide === 0) windowIndex++;\n    // add the current window to the list of windows if needed\n    if (!(windows.length) || windows[windows.length-1] !== windowIndex) {\n      windows.push(windowIndex);\n    }\n    // identify first and last word indices in window. Remove first window if needed\n    var start = windows[0] * props.config.window_slide;\n    var end = start + props.config.window_size;\n    if (wordIndex >= end) {\n      windows = windows.slice(1);\n    }\n    // add the word itself\n    words.push({\n      word: word.replaceAll('<br/>', ''),\n      windows: windows.slice(0), // clone the object\n    })\n    // add any trailing line breaks\n    while (word.includes('<br/>')) {\n      word = word.replace('<br/>', '');\n      words.push({\n        word: '<br/>',\n        windows: null,\n      })\n    }\n  })\n  var rows = [];\n  if (offscreenRef && offscreenRef.current) {\n    // add the line number to each word in the words list\n    var offscreen = offscreenRef.current;\n    offscreen.innerHTML = '';\n    offscreen.style.position = 'absolute';\n    offscreen.style.top = '-1000%';\n    offscreen.style.left = '-1000%';\n    offscreen.classList.add('viewer-text-column');\n    var row = [];\n    var height = 0; // store the last seen height of offscreen\n    var s = '';\n    for (var i=0; i<words.length; i++) {\n      s += words[i].word + ' ';\n      offscreen.innerHTML = s;\n      if (offscreen.clientHeight !== height) {\n        height = offscreen.clientHeight;\n        rows.push(row);\n        row = [];\n      }\n      row.push(words[i]);\n    }\n  }\n  return rows;\n}\n\n/**\n * Match cards\n **/\n\nconst MatchRow = props => {\n\n  const isSource = props.otherId === props.m.source_file_id.toString();\n\n  const getRowText = m => {\n    return isSource\n      ? m.target_prematch + m.target_match + m.target_postmatch\n      : m.source_prematch + m.source_match + m.source_postmatch\n  }\n\n  return (\n    <div className='match-row'>\n      <Card result={props.m} type={isSource ? 'source' : 'target'} headerRight={true} />\n    </div>\n  )\n}\n\nconst mapStateToProps = state => ({\n  words: state.viewer.words,\n  matches: state.viewer.matches,\n  fileId: state.viewer.fileId || '',\n  config: state.search.config,\n})\n\nconst mapDispatchToProps = dispatch => ({\n  getViewerData: fileId => dispatch(viewerActions.getViewerData(fileId)),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Viewer)","import { getWordsFile, getMatchFile } from './search'\n\nexport const getViewerData = fileId => {\n  return (dispatch) => {\n    Promise.all([\n      dispatch(getWordsFile(fileId)),\n      dispatch(getMatchFile(fileId)),\n    ]).then(r => {\n      const [words, matches] = r;\n      dispatch({\n        type: 'SET_VIEWER_DATA',\n        fileId: fileId,\n        matches: matches,\n        words: words,\n      })\n    })\n  }\n}","import React from 'react';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport App from './components/App';\nimport Cards from './components/cards/Cards';\nimport Waffle from './components/charts/Waffle';\nimport Sankey from './components/charts/Sankey';\nimport Scatterplot from './components/charts/Scatterplot';\nimport Works from './components/works/Works';\nimport Viewer from './components/viewer/Viewer';\n\nconst routes = (\n  <App>\n    <Switch>\n      <Route path='/sankey' component={Sankey} />\n      <Route path='/waffle' component={Waffle} />\n      <Route path='/scatterplot' component={Scatterplot} />\n      <Route path='/works' component={Works} />\n      <Route path='/cards' component={Cards} />\n      <Route path='/viewer/:id' component={Viewer} />\n      <Route exact path='/' component={Cards}>\n        <Redirect to='cards' />\n      </Route>\n    </Switch>\n  </App>\n);\n\nexport { routes };\n","import 'babel-polyfill';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { store, history } from './store';\nimport { routes } from './routes';\nimport { ConnectedRouter } from 'connected-react-router';\nimport './assets/styles/style';\n\n// render the main component\nReactDOM.render(\n  <Provider store={store}>\n    <ConnectedRouter history={history}>{routes}</ConnectedRouter>\n  </Provider>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}